var Xe=Object.defineProperty;var ce=Object.getOwnPropertySymbols;var Je=Object.prototype.hasOwnProperty,Ze=Object.prototype.propertyIsEnumerable;var _e=(g,v,s)=>v in g?Xe(g,v,{enumerable:!0,configurable:!0,writable:!0,value:s}):g[v]=s,fe=(g,v)=>{for(var s in v||(v={}))Je.call(v,s)&&_e(g,s,v[s]);if(ce)for(var s of ce(v))Ze.call(v,s)&&_e(g,s,v[s]);return g};import{a1 as el,G as ll,g as i,aa as tl,a4 as ol,r,ab as ve,o as c,i as P,W as h,X as I,j as t,w as o,k as u,a8 as he,z as W,C as X,c as y,p as j,t as ye,l as z,A as m,Q as al,S as ge}from"./vendor.dda3acc4.js";import{l as nl,t as ul,v as dl,w as sl,x as ke,y as rl,z as il,A as pl,B as ml}from"./index.6a9993b0.js";import{t as cl}from"./menu.ee422d77.js";import{t as _l}from"./dept.b4e9a293.js";const fl={class:"app-container"},vl=m("\u641C\u7D22"),hl=m("\u91CD\u7F6E"),yl=m("\u65B0\u589E"),gl=m("\u4FEE\u6539"),kl=m("\u5220\u9664"),bl=m("\u5BFC\u51FA"),Vl=m(' v-model:showSearch="showSearch" @queryTable="getList" >'),Cl=m(" \u6743\u9650\u5B57\u7B26 "),wl=m("\u5C55\u5F00/\u6298\u53E0"),xl=m("\u5168\u9009/\u5168\u4E0D\u9009"),Sl=m("\u7236\u5B50\u8054\u52A8"),Ul={class:"dialog-footer"},Rl=m("\u786E \u5B9A"),Dl=m("\u53D6 \u6D88"),Kl=m("\u5C55\u5F00/\u6298\u53E0"),$l=m("\u5168\u9009/\u5168\u4E0D\u9009"),Nl=m("\u7236\u5B50\u8054\u52A8"),Al={class:"dialog-footer"},Tl=m("\u786E \u5B9A"),ql=m("\u53D6 \u6D88"),El=el({name:"Role"}),Bl=Object.assign(El,{setup(g){const v=ll(),{proxy:s}=al(),{sys_normal_disable:J}=s.useDict("sys_normal_disable"),Z=i([]),w=i(!1),L=i(!0),be=i(!0),B=i([]),ee=i([]),le=i(!0),te=i(!0),F=i(0),R=i(""),N=i([]),A=i([]),O=i(!1),Y=i(!1),Q=i(!0),H=i(!1),T=i([]),D=i(!1),k=i(null),b=i(null),Ve=i([{value:"1",label:"\u5168\u90E8\u6570\u636E\u6743\u9650"},{value:"2",label:"\u81EA\u5B9A\u6570\u636E\u6743\u9650"},{value:"3",label:"\u672C\u90E8\u95E8\u6570\u636E\u6743\u9650"},{value:"4",label:"\u672C\u90E8\u95E8\u53CA\u4EE5\u4E0B\u6570\u636E\u6743\u9650"},{value:"5",label:"\u4EC5\u672C\u4EBA\u6570\u636E\u6743\u9650"}]),Ce=tl({form:{},queryParams:{page_num:1,page_size:10,role_name:void 0,role_key:void 0,status:void 0},rules:{role_name:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],role_key:[{required:!0,message:"\u6743\u9650\u5B57\u7B26\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],list_order:[{required:!0,message:"\u89D2\u8272\u987A\u5E8F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}}),{queryParams:_,form:n,rules:we}=ol(Ce);function x(){L.value=!0,nl(s.addDateRange(_.value,N.value)).then(a=>{Z.value=a.list,F.value=a.total,L.value=!1})}function q(){_.value.page_num=1,x()}function xe(){N.value=[],s.resetForm("queryRef"),q()}function oe(a){const e=a.role_id?[a.role_id]:B.value,p=a.role_id?a.role_name:ee.value;s.$modal.confirm('\u662F\u5426\u786E\u8BA4\u5220\u9664\u89D2\u8272\u7F16\u53F7\u4E3A"'+p+'"\u7684\u6570\u636E\u9879?').then(function(){return ul({role_ids:e})}).then(()=>{x(),s.$modal.msgSuccess("\u5220\u9664\u6210\u529F")}).catch(()=>{})}function Se(){s.download("system/role/export",fe({},_.value),`role_${new Date().getTime()}.xlsx`)}function Ue(a){B.value=a.map(e=>e.role_id),ee.value=a.map(e=>e.role_name),le.value=a.length!=1,te.value=!a.length}function Re(a){let e=a.status==="1"?"\u542F\u7528":"\u505C\u7528";s.$modal.confirm('\u786E\u8BA4\u8981"'+e+'""'+a.role_name+'"\u89D2\u8272\u5417?').then(function(){return dl(a.role_id,a.status)}).then(()=>{s.$modal.msgSuccess(e+"\u6210\u529F")}).catch(function(){a.status=a.status==="0"?"1":"0"})}function De(a){v.push("/system/role-auth/user/"+a.role_id)}function ae(){cl().then(a=>{A.value=a})}function Ke(){_l().then(a=>{T.value=a})}function $e(){let a=b.value.getCheckedKeys(),e=b.value.getHalfCheckedKeys();return a.unshift.apply(a,e),a}function K(){k.value!=null&&k.value.setCheckedKeys([]),O.value=!1,Y.value=!1,Q.value=!0,H.value=!1,n.value={role_id:void 0,role_name:void 0,role_key:void 0,list_order:0,status:"1",menu_ids:[],dept_ids:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},s.resetForm("roleRef")}function Ne(){K(),ae(),w.value=!0,R.value="\u6DFB\u52A0\u89D2\u8272"}async function ne(a){K();const e=a.role_id||B.value[0];ae();const p=await sl({role_id:e});ke({role_id:e}).then(d=>{n.value=d,n.value.list_order=Number(n.value.list_order),w.value=!0,p.forEach(E=>{ge(()=>{k.value.setChecked(E,!0,!1)})}),R.value="\u4FEE\u6539\u89D2\u8272"})}function ue(a,e){if(e=="menu"){let p=A.value;for(let d=0;d<p.length;d++)k.value.store.nodesMap[p[d].id].expanded=a}else if(e=="dept"){let p=T.value;for(let d=0;d<p.length;d++)b.value.store.nodesMap[p[d].id].expanded=a}}function de(a,e){e=="menu"?k.value.setCheckedNodes(a?A.value:[]):e=="dept"&&b.value.setCheckedNodes(a?T.value:[])}function se(a,e){e=="menu"?n.value.menuCheckStrictly=!!a:e=="dept"&&(n.value.deptCheckStrictly=!!a)}function re(){let a=k.value.getCheckedKeys(),e=k.value.getHalfCheckedKeys();return a.unshift.apply(a,e),a}function Ae(){s.$refs.roleRef.validate(a=>{a&&(n.value.role_id!=null?(n.value.menu_ids=re(),rl(n.value).then(e=>{s.$modal.msgSuccess("\u4FEE\u6539\u6210\u529F"),w.value=!1,x()})):(n.value.menu_ids=re(),console.log("form.value.menu_ids",n.value.menu_ids),il(n.value).then(e=>{s.$modal.msgSuccess("\u65B0\u589E\u6210\u529F"),w.value=!1,x()})))})}function Te(){w.value=!1,K()}function qe(a){a!=="2"&&b.value.setCheckedKeys([])}async function Ee(a){K();const e=a.role_id;Ke();const p=await pl({role_id:e});ke({role_id:e}).then(d=>{n.value=d,D.value=!0,ge(()=>{b.value&&b.value.setCheckedKeys(p)})}),R.value="\u5206\u914D\u6570\u636E\u6743\u9650"}function Me(){n.value.role_id!=null&&(n.value.dept_ids=$e(),ml(n.value).then(a=>{s.$modal.msgSuccess("\u4FEE\u6539\u6210\u529F"),D.value=!1,x()}))}function Pe(){D.value=!1,K()}return x(),(a,e)=>{const p=r("el-input"),d=r("el-form-item"),E=r("el-option"),ie=r("el-select"),je=r("el-date-picker"),f=r("el-button"),G=r("el-form"),M=r("el-col"),ze=r("right-toolbar"),Le=r("el-row"),V=r("el-table-column"),Be=r("el-switch"),$=r("el-tooltip"),Fe=r("el-table"),Oe=r("pagination"),Ye=r("info-filled"),Qe=r("el-icon"),He=r("el-input-number"),Ge=r("el-radio"),Ie=r("el-radio-group"),S=r("el-checkbox"),pe=r("el-tree"),me=r("el-dialog"),C=ve("hasPermi"),We=ve("loading");return c(),P("div",fl,[h(t(G,{model:u(_),ref:"queryRef",inline:!0},{default:o(()=>[t(d,{label:"\u89D2\u8272\u540D\u79F0",prop:"role_name"},{default:o(()=>[t(p,{modelValue:u(_).role_name,"onUpdate:modelValue":e[0]||(e[0]=l=>u(_).role_name=l),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",clearable:"",style:{width:"240px"},onKeyup:he(q,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(d,{label:"\u6743\u9650\u5B57\u7B26",prop:"role_key"},{default:o(()=>[t(p,{modelValue:u(_).role_key,"onUpdate:modelValue":e[1]||(e[1]=l=>u(_).role_key=l),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u5B57\u7B26",clearable:"",style:{width:"240px"},onKeyup:he(q,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(d,{label:"\u72B6\u6001",prop:"status"},{default:o(()=>[t(ie,{modelValue:u(_).status,"onUpdate:modelValue":e[2]||(e[2]=l=>u(_).status=l),placeholder:"\u89D2\u8272\u72B6\u6001",clearable:"",style:{width:"240px"}},{default:o(()=>[(c(!0),P(W,null,X(u(J),l=>(c(),y(E,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"\u521B\u5EFA\u65F6\u95F4"},{default:o(()=>[t(je,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=l=>N.value=l),style:{width:"240px"},"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),_:1}),t(d,null,{default:o(()=>[t(f,{type:"primary",icon:"Search",onClick:q},{default:o(()=>[vl]),_:1}),t(f,{icon:"Refresh",onClick:xe},{default:o(()=>[hl]),_:1})]),_:1})]),_:1},8,["model"]),[[I,be.value]]),t(Le,{gutter:10,class:"mb8",style:{height:"35px"}},{default:o(()=>[t(M,{span:1.5},{default:o(()=>[h((c(),y(f,{type:"primary",plain:"",icon:"Plus",onClick:Ne},{default:o(()=>[yl]),_:1})),[[C,["system:role:add"]]])]),_:1},8,["span"]),t(M,{span:1.5},{default:o(()=>[h((c(),y(f,{type:"success",plain:"",icon:"Edit",disabled:le.value,onClick:ne},{default:o(()=>[gl]),_:1},8,["disabled"])),[[C,["system:role:edit"]]])]),_:1},8,["span"]),t(M,{span:1.5},{default:o(()=>[h((c(),y(f,{type:"danger",plain:"",icon:"Delete",disabled:te.value,onClick:oe},{default:o(()=>[kl]),_:1},8,["disabled"])),[[C,["system:role:remove"]]])]),_:1},8,["span"]),t(M,{span:1.5},{default:o(()=>[h((c(),y(f,{type:"warning",plain:"",icon:"Download",onClick:Se},{default:o(()=>[bl]),_:1})),[[C,["system:role:export"]]])]),_:1},8,["span"]),t(ze,null,{default:o(()=>[Vl]),_:1})]),_:1}),h((c(),y(Fe,{data:Z.value,onSelectionChange:Ue},{default:o(()=>[t(V,{type:"selection",width:"55",align:"center"}),t(V,{label:"\u89D2\u8272\u7F16\u53F7",prop:"role_id",width:"120","show-overflow-tooltip":""}),t(V,{label:"\u89D2\u8272\u540D\u79F0",prop:"role_name","show-overflow-tooltip":!0,width:"150"}),t(V,{label:"\u6743\u9650\u5B57\u7B26",prop:"role_key","show-overflow-tooltip":!0,width:"150"}),t(V,{label:"\u663E\u793A\u987A\u5E8F",prop:"list_order",width:"100"}),t(V,{label:"\u72B6\u6001",align:"center",width:"100"},{default:o(l=>[t(Be,{modelValue:l.row.status,"onUpdate:modelValue":U=>l.row.status=U,"active-value":"1","inactive-value":"0",onChange:U=>Re(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(V,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"created_at",width:"160"},{default:o(l=>[j("span",null,ye(a.parseTime(l.row.created_at)),1)]),_:1}),t(V,{label:"\u64CD\u4F5C",align:"center","class-name":"small-padding fixed-width"},{default:o(l=>[t($,{content:"\u4FEE\u6539",placement:"top"},{default:o(()=>[l.row.role_id!==1?h((c(),y(f,{key:0,type:"text",icon:"Edit",onClick:U=>ne(l.row)},null,8,["onClick"])),[[C,["system:role:edit"]]]):z("",!0)]),_:2},1024),t($,{content:"\u5220\u9664",placement:"top"},{default:o(()=>[l.row.role_id!==1?h((c(),y(f,{key:0,type:"text",icon:"Delete",onClick:U=>oe(l.row)},null,8,["onClick"])),[[C,["system:role:remove"]]]):z("",!0)]),_:2},1024),t($,{content:"\u6570\u636E\u6743\u9650",placement:"top"},{default:o(()=>[l.row.role_id!==1?h((c(),y(f,{key:0,type:"text",icon:"CircleCheck",onClick:U=>Ee(l.row)},null,8,["onClick"])),[[C,["system:role:edit"]]]):z("",!0)]),_:2},1024),t($,{content:"\u5206\u914D\u7528\u6237",placement:"top"},{default:o(()=>[l.row.role_id!==1?h((c(),y(f,{key:0,type:"text",icon:"User",onClick:U=>De(l.row)},null,8,["onClick"])),[[C,["system:role:edit"]]]):z("",!0)]),_:2},1024)]),_:1})]),_:1},8,["data"])),[[We,L.value]]),h(t(Oe,{total:F.value,page:u(_).page_num,"onUpdate:page":e[4]||(e[4]=l=>u(_).page_num=l),limit:u(_).page_size,"onUpdate:limit":e[5]||(e[5]=l=>u(_).page_size=l),onPagination:x},null,8,["total","page","limit"]),[[I,F.value>0]]),t(me,{title:R.value,modelValue:w.value,"onUpdate:modelValue":e[17]||(e[17]=l=>w.value=l),width:"500px","append-to-body":""},{footer:o(()=>[j("div",Ul,[t(f,{type:"primary",onClick:Ae},{default:o(()=>[Rl]),_:1}),t(f,{onClick:Te},{default:o(()=>[Dl]),_:1})])]),default:o(()=>[t(G,{ref:"roleRef",model:u(n),rules:u(we),"label-width":"100px"},{default:o(()=>[t(d,{label:"\u89D2\u8272\u540D\u79F0",prop:"role_name"},{default:o(()=>[t(p,{modelValue:u(n).role_name,"onUpdate:modelValue":e[6]||(e[6]=l=>u(n).role_name=l),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(d,{prop:"role_key"},{label:o(()=>[j("span",null,[t($,{content:"\u63A7\u5236\u5668\u4E2D\u5B9A\u4E49\u7684\u6743\u9650\u5B57\u7B26\uFF0C\u5982\uFF1A@PreAuthorize(`@ss.hasRole('admin')`)",placement:"top"},{default:o(()=>[t(Qe,null,{default:o(()=>[t(Ye)]),_:1})]),_:1}),Cl])]),default:o(()=>[t(p,{modelValue:u(n).role_key,"onUpdate:modelValue":e[7]||(e[7]=l=>u(n).role_key=l),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u5B57\u7B26"},null,8,["modelValue"])]),_:1}),t(d,{label:"\u89D2\u8272\u987A\u5E8F",prop:"list_order"},{default:o(()=>[t(He,{modelValue:u(n).list_order,"onUpdate:modelValue":e[8]||(e[8]=l=>u(n).list_order=l),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),t(d,{label:"\u72B6\u6001"},{default:o(()=>[t(Ie,{modelValue:u(n).status,"onUpdate:modelValue":e[9]||(e[9]=l=>u(n).status=l)},{default:o(()=>[(c(!0),P(W,null,X(u(J),l=>(c(),y(Ge,{key:l.value,label:l.value},{default:o(()=>[m(ye(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(d,{label:"\u83DC\u5355\u6743\u9650"},{default:o(()=>[t(S,{modelValue:O.value,"onUpdate:modelValue":e[10]||(e[10]=l=>O.value=l),onChange:e[11]||(e[11]=l=>ue(l,"menu"))},{default:o(()=>[wl]),_:1},8,["modelValue"]),t(S,{modelValue:Y.value,"onUpdate:modelValue":e[12]||(e[12]=l=>Y.value=l),onChange:e[13]||(e[13]=l=>de(l,"menu"))},{default:o(()=>[xl]),_:1},8,["modelValue"]),t(S,{modelValue:u(n).menuCheckStrictly,"onUpdate:modelValue":e[14]||(e[14]=l=>u(n).menuCheckStrictly=l),onChange:e[15]||(e[15]=l=>se(l,"menu"))},{default:o(()=>[Sl]),_:1},8,["modelValue"]),t(pe,{class:"tree-border",data:A.value,"show-checkbox":"",ref_key:"menuRef",ref:k,"node-key":"id","check-strictly":!u(n).menuCheckStrictly,"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019",props:{label:"menu_name",children:"children"}},null,8,["data","check-strictly"])]),_:1}),t(d,{label:"\u5907\u6CE8"},{default:o(()=>[t(p,{modelValue:u(n).remark,"onUpdate:modelValue":e[16]||(e[16]=l=>u(n).remark=l),type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(me,{title:R.value,modelValue:D.value,"onUpdate:modelValue":e[27]||(e[27]=l=>D.value=l),width:"500px","append-to-body":""},{footer:o(()=>[j("div",Al,[t(f,{type:"primary",onClick:Me},{default:o(()=>[Tl]),_:1}),t(f,{onClick:Pe},{default:o(()=>[ql]),_:1})])]),default:o(()=>[t(G,{model:u(n),"label-width":"80px"},{default:o(()=>[t(d,{label:"\u89D2\u8272\u540D\u79F0"},{default:o(()=>[t(p,{modelValue:u(n).role_name,"onUpdate:modelValue":e[18]||(e[18]=l=>u(n).role_name=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(d,{label:"\u6743\u9650\u5B57\u7B26"},{default:o(()=>[t(p,{modelValue:u(n).role_key,"onUpdate:modelValue":e[19]||(e[19]=l=>u(n).role_key=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(d,{label:"\u6743\u9650\u8303\u56F4"},{default:o(()=>[t(ie,{modelValue:u(n).data_scope,"onUpdate:modelValue":e[20]||(e[20]=l=>u(n).data_scope=l),onChange:qe},{default:o(()=>[(c(!0),P(W,null,X(Ve.value,l=>(c(),y(E,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),h(t(d,{label:"\u6570\u636E\u6743\u9650"},{default:o(()=>[t(S,{modelValue:Q.value,"onUpdate:modelValue":e[21]||(e[21]=l=>Q.value=l),onChange:e[22]||(e[22]=l=>ue(l,"dept"))},{default:o(()=>[Kl]),_:1},8,["modelValue"]),t(S,{modelValue:H.value,"onUpdate:modelValue":e[23]||(e[23]=l=>H.value=l),onChange:e[24]||(e[24]=l=>de(l,"dept"))},{default:o(()=>[$l]),_:1},8,["modelValue"]),t(S,{modelValue:u(n).deptCheckStrictly,"onUpdate:modelValue":e[25]||(e[25]=l=>u(n).deptCheckStrictly=l),onChange:e[26]||(e[26]=l=>se(l,"dept"))},{default:o(()=>[Nl]),_:1},8,["modelValue"]),t(pe,{class:"tree-border",data:T.value,"show-checkbox":"","default-expand-all":"",ref_key:"deptRef",ref:b,"node-key":"dept_id","check-strictly":!u(n).deptCheckStrictly,"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019",props:{label:"dept_name",children:"children"}},null,8,["data","check-strictly"])]),_:1},512),[[I,u(n).data_scope==2]])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{Bl as default};
