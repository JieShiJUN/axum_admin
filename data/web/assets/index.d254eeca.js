var ll=Object.defineProperty;var ce=Object.getOwnPropertySymbols;var tl=Object.prototype.hasOwnProperty,ol=Object.prototype.propertyIsEnumerable;var fe=(k,h,r)=>h in k?ll(k,h,{enumerable:!0,configurable:!0,writable:!0,value:r}):k[h]=r,ve=(k,h)=>{for(var r in h||(h={}))tl.call(h,r)&&fe(k,r,h[r]);if(ce)for(var r of ce(h))ol.call(h,r)&&fe(k,r,h[r]);return k};import{a0 as al,D as nl,g as m,a9 as dl,a3 as sl,r as u,aa as he,o as _,i as K,V as f,W as I,j as t,w as o,k as d,a7 as ye,y as W,B as G,c as v,m as $,t as ge,l as J,z as i,P as ul,Q as ke}from"./vendor.8d886737.js";import{l as rl,d as il,e as ml,g as pl,f as be,h as _l,i as cl,j as fl,k as vl}from"./role.8100c124.js";import{t as hl}from"./menu.718a31ad.js";import{t as yl}from"./dept.96e12fd0.js";import"./index.c83df884.js";const gl={class:"app-container"},kl=i("\u641C\u7D22"),bl=i("\u91CD\u7F6E"),Vl=i("\u65B0\u589E"),Cl=i("\u4FEE\u6539"),wl=i("\u5220\u9664"),xl=i("\u5BFC\u51FA"),Sl=i("\u4FEE\u6539"),Ul=i("\u5220\u9664"),Rl={class:"el-dropdown-link"},Dl=i("\u66F4\u591A "),zl=i("\u6570\u636E\u6743\u9650"),Kl=i("\u5206\u914D\u7528\u6237"),$l=$("i",{class:"el-icon-question"},null,-1),Nl=i(" \u6743\u9650\u5B57\u7B26 "),Al=i("\u5C55\u5F00/\u6298\u53E0"),Tl=i("\u5168\u9009/\u5168\u4E0D\u9009"),jl=i("\u7236\u5B50\u8054\u52A8"),ql={class:"dialog-footer"},El=i("\u786E \u5B9A"),Ml=i("\u53D6 \u6D88"),Pl=i("\u5C55\u5F00/\u6298\u53E0"),Bl=i("\u5168\u9009/\u5168\u4E0D\u9009"),Ll=i("\u7236\u5B50\u8054\u52A8"),Fl={class:"dialog-footer"},Ol=i("\u786E \u5B9A"),Ql=i("\u53D6 \u6D88"),Yl=al({name:"Role"}),Zl=Object.assign(Yl,{setup(k){const h=nl(),{proxy:r}=ul(),{sys_normal_disable:X}=r.useDict("sys_normal_disable"),Z=m([]),x=m(!1),M=m(!0),P=m(!0),B=m([]),ee=m([]),le=m(!0),te=m(!0),L=m(0),R=m(""),N=m([]),A=m([]),F=m(!1),O=m(!1),Q=m(!0),Y=m(!1),T=m([]),D=m(!1),b=m(null),V=m(null),Ve=m([{value:"1",label:"\u5168\u90E8\u6570\u636E\u6743\u9650"},{value:"2",label:"\u81EA\u5B9A\u6570\u636E\u6743\u9650"},{value:"3",label:"\u672C\u90E8\u95E8\u6570\u636E\u6743\u9650"},{value:"4",label:"\u672C\u90E8\u95E8\u53CA\u4EE5\u4E0B\u6570\u636E\u6743\u9650"},{value:"5",label:"\u4EC5\u672C\u4EBA\u6570\u636E\u6743\u9650"}]),Ce=dl({form:{},queryParams:{page_num:1,page_size:10,role_name:void 0,role_key:void 0,status:void 0},rules:{role_name:[{required:!0,message:"\u89D2\u8272\u540D\u79F0\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],role_key:[{required:!0,message:"\u6743\u9650\u5B57\u7B26\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}],list_order:[{required:!0,message:"\u89D2\u8272\u987A\u5E8F\u4E0D\u80FD\u4E3A\u7A7A",trigger:"blur"}]}}),{queryParams:c,form:n,rules:we}=sl(Ce);function C(){M.value=!0,rl(r.addDateRange(c.value,N.value)).then(a=>{Z.value=a.list,L.value=a.total,M.value=!1})}function j(){c.value.page_num=1,C()}function xe(){N.value=[],r.resetForm("queryRef"),j()}function oe(a){const e=a.role_id?[a.role_id]:B.value,p=a.role_id?a.role_name:ee.value;r.$modal.confirm('\u662F\u5426\u786E\u8BA4\u5220\u9664\u89D2\u8272\u7F16\u53F7\u4E3A"'+p+'"\u7684\u6570\u636E\u9879?').then(function(){return il({role_ids:e})}).then(()=>{C(),r.$modal.msgSuccess("\u5220\u9664\u6210\u529F")}).catch(()=>{})}function Se(){r.download("system/role/export",ve({},c.value),`role_${new Date().getTime()}.xlsx`)}function Ue(a){B.value=a.map(e=>e.role_id),ee.value=a.map(e=>e.role_name),le.value=a.length!=1,te.value=!a.length}function Re(a){let e=a.status==="1"?"\u542F\u7528":"\u505C\u7528";r.$modal.confirm('\u786E\u8BA4\u8981"'+e+'""'+a.role_name+'"\u89D2\u8272\u5417?').then(function(){return ml(a.role_id,a.status)}).then(()=>{r.$modal.msgSuccess(e+"\u6210\u529F")}).catch(function(){a.status=a.status==="0"?"1":"0"})}function De(a,e){switch(a){case"handleDataScope":qe(e);break;case"handleAuthUser":ze(e);break}}function ze(a){h.push("/system/role-auth/user/"+a.role_id)}function ae(){hl().then(a=>{A.value=a})}function Ke(){yl().then(a=>{T.value=a})}function $e(){let a=V.value.getCheckedKeys(),e=V.value.getHalfCheckedKeys();return a.unshift.apply(a,e),a}function z(){b.value!=null&&b.value.setCheckedKeys([]),F.value=!1,O.value=!1,Q.value=!0,Y.value=!1,n.value={role_id:void 0,role_name:void 0,role_key:void 0,list_order:0,status:"1",menu_ids:[],dept_ids:[],menuCheckStrictly:!0,deptCheckStrictly:!0,remark:void 0},r.resetForm("roleRef")}function Ne(){z(),ae(),x.value=!0,R.value="\u6DFB\u52A0\u89D2\u8272"}async function ne(a){z();const e=a.role_id||B.value[0];ae();const p=await pl({role_id:e});be({role_id:e}).then(s=>{n.value=s,n.value.list_order=Number(n.value.list_order),x.value=!0,p.forEach(q=>{ke(()=>{b.value.setChecked(q,!0,!1)})}),R.value="\u4FEE\u6539\u89D2\u8272"})}function de(a,e){if(e=="menu"){let p=A.value;for(let s=0;s<p.length;s++)b.value.store.nodesMap[p[s].id].expanded=a}else if(e=="dept"){let p=T.value;for(let s=0;s<p.length;s++)V.value.store.nodesMap[p[s].id].expanded=a}}function se(a,e){e=="menu"?b.value.setCheckedNodes(a?A.value:[]):e=="dept"&&V.value.setCheckedNodes(a?T.value:[])}function ue(a,e){e=="menu"?n.value.menuCheckStrictly=!!a:e=="dept"&&(n.value.deptCheckStrictly=!!a)}function re(){let a=b.value.getCheckedKeys(),e=b.value.getHalfCheckedKeys();return a.unshift.apply(a,e),a}function Ae(){r.$refs.roleRef.validate(a=>{a&&(n.value.role_id!=null?(n.value.menu_ids=re(),_l(n.value).then(e=>{r.$modal.msgSuccess("\u4FEE\u6539\u6210\u529F"),x.value=!1,C()})):(n.value.menu_ids=re(),console.log("form.value.menu_ids",n.value.menu_ids),cl(n.value).then(e=>{r.$modal.msgSuccess("\u65B0\u589E\u6210\u529F"),x.value=!1,C()})))})}function Te(){x.value=!1,z()}function je(a){a!=="2"&&V.value.setCheckedKeys([])}async function qe(a){z();const e=a.role_id;Ke();const p=await fl({role_id:e});be({role_id:e}).then(s=>{n.value=s,D.value=!0,ke(()=>{V.value&&V.value.setCheckedKeys(p)})}),R.value="\u5206\u914D\u6570\u636E\u6743\u9650"}function Ee(){n.value.role_id!=null&&(n.value.dept_ids=$e(),vl(n.value).then(a=>{r.$modal.msgSuccess("\u4FEE\u6539\u6210\u529F"),D.value=!1,C()}))}function Me(){D.value=!1,z()}return C(),(a,e)=>{const p=u("el-input"),s=u("el-form-item"),q=u("el-option"),ie=u("el-select"),Pe=u("el-date-picker"),y=u("el-button"),H=u("el-form"),E=u("el-col"),Be=u("right-toolbar"),Le=u("el-row"),w=u("el-table-column"),Fe=u("el-switch"),Oe=u("d-arrow-right"),Qe=u("el-icon"),me=u("el-dropdown-item"),Ye=u("el-dropdown-menu"),He=u("el-dropdown"),Ie=u("el-table"),We=u("pagination"),Ge=u("el-tooltip"),Je=u("el-input-number"),Xe=u("el-radio"),Ze=u("el-radio-group"),S=u("el-checkbox"),pe=u("el-tree"),_e=u("el-dialog"),g=he("hasPermi"),el=he("loading");return _(),K("div",gl,[f(t(H,{model:d(c),ref:"queryRef",inline:!0},{default:o(()=>[t(s,{label:"\u89D2\u8272\u540D\u79F0",prop:"role_name"},{default:o(()=>[t(p,{modelValue:d(c).role_name,"onUpdate:modelValue":e[0]||(e[0]=l=>d(c).role_name=l),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0",clearable:"",size:"small",style:{width:"240px"},onKeyup:ye(j,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(s,{label:"\u6743\u9650\u5B57\u7B26",prop:"role_key"},{default:o(()=>[t(p,{modelValue:d(c).role_key,"onUpdate:modelValue":e[1]||(e[1]=l=>d(c).role_key=l),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u5B57\u7B26",clearable:"",size:"small",style:{width:"240px"},onKeyup:ye(j,["enter"])},null,8,["modelValue","onKeyup"])]),_:1}),t(s,{label:"\u72B6\u6001",prop:"status"},{default:o(()=>[t(ie,{modelValue:d(c).status,"onUpdate:modelValue":e[2]||(e[2]=l=>d(c).status=l),placeholder:"\u89D2\u8272\u72B6\u6001",clearable:"",size:"small",style:{width:"240px"}},{default:o(()=>[(_(!0),K(W,null,G(d(X),l=>(_(),v(q,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(s,{label:"\u521B\u5EFA\u65F6\u95F4"},{default:o(()=>[t(Pe,{modelValue:N.value,"onUpdate:modelValue":e[3]||(e[3]=l=>N.value=l),size:"small",style:{width:"240px"},"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"\u5F00\u59CB\u65E5\u671F","end-placeholder":"\u7ED3\u675F\u65E5\u671F"},null,8,["modelValue"])]),_:1}),t(s,null,{default:o(()=>[t(y,{type:"primary",icon:"Search",size:"mini",onClick:j},{default:o(()=>[kl]),_:1}),t(y,{icon:"Refresh",size:"mini",onClick:xe},{default:o(()=>[bl]),_:1})]),_:1})]),_:1},8,["model"]),[[I,P.value]]),t(Le,{gutter:10,class:"mb8"},{default:o(()=>[t(E,{span:1.5},{default:o(()=>[f((_(),v(y,{type:"primary",plain:"",icon:"Plus",size:"mini",onClick:Ne},{default:o(()=>[Vl]),_:1})),[[g,["system:role:add"]]])]),_:1},8,["span"]),t(E,{span:1.5},{default:o(()=>[f((_(),v(y,{type:"success",plain:"",icon:"Edit",size:"mini",disabled:le.value,onClick:ne},{default:o(()=>[Cl]),_:1},8,["disabled"])),[[g,["system:role:edit"]]])]),_:1},8,["span"]),t(E,{span:1.5},{default:o(()=>[f((_(),v(y,{type:"danger",plain:"",icon:"Delete",size:"mini",disabled:te.value,onClick:oe},{default:o(()=>[wl]),_:1},8,["disabled"])),[[g,["system:role:remove"]]])]),_:1},8,["span"]),t(E,{span:1.5},{default:o(()=>[f((_(),v(y,{type:"warning",plain:"",icon:"Download",size:"mini",onClick:Se},{default:o(()=>[xl]),_:1})),[[g,["system:role:export"]]])]),_:1},8,["span"]),t(Be,{showSearch:P.value,"onUpdate:showSearch":e[4]||(e[4]=l=>P.value=l),onQueryTable:C},null,8,["showSearch"])]),_:1}),f((_(),v(Ie,{data:Z.value,onSelectionChange:Ue},{default:o(()=>[t(w,{type:"selection",width:"55",align:"center"}),t(w,{label:"\u89D2\u8272\u7F16\u53F7",prop:"role_id",width:"120","show-overflow-tooltip":""}),t(w,{label:"\u89D2\u8272\u540D\u79F0",prop:"role_name","show-overflow-tooltip":!0,width:"150"}),t(w,{label:"\u6743\u9650\u5B57\u7B26",prop:"role_key","show-overflow-tooltip":!0,width:"150"}),t(w,{label:"\u663E\u793A\u987A\u5E8F",prop:"list_order",width:"100"}),t(w,{label:"\u72B6\u6001",align:"center",width:"100"},{default:o(l=>[t(Fe,{modelValue:l.row.status,"onUpdate:modelValue":U=>l.row.status=U,"active-value":"1","inactive-value":"0",onChange:U=>Re(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])]),_:1}),t(w,{label:"\u521B\u5EFA\u65F6\u95F4",align:"center",prop:"created_at",width:"180"},{default:o(l=>[$("span",null,ge(a.parseTime(l.row.created_at)),1)]),_:1}),t(w,{label:"\u64CD\u4F5C",align:"center","class-name":"small-padding fixed-width"},{default:o(l=>[l.row.role_id!==1?f((_(),v(y,{key:0,size:"mini",type:"text",icon:"Edit",onClick:U=>ne(l.row)},{default:o(()=>[Sl]),_:2},1032,["onClick"])),[[g,["system:role:edit"]]]):J("",!0),l.row.role_id!==1?f((_(),v(y,{key:1,size:"mini",type:"text",icon:"Delete",onClick:U=>oe(l.row)},{default:o(()=>[Ul]),_:2},1032,["onClick"])),[[g,["system:role:remove"]]]):J("",!0),l.row.role_id!==1?(_(),v(He,{key:2,size:"mini",onCommand:U=>De(U,l.row)},{dropdown:o(()=>[t(Ye,null,{default:o(()=>[f((_(),v(me,{command:"handleDataScope",icon:"CircleCheck"},{default:o(()=>[zl]),_:1})),[[g,["system:role:edit"]]]),f((_(),v(me,{command:"handleAuthUser",icon:"User"},{default:o(()=>[Kl]),_:1})),[[g,["system:role:edit"]]])]),_:1})]),default:o(()=>[f((_(),K("span",Rl,[t(Qe,null,{default:o(()=>[t(Oe)]),_:1}),Dl])),[[g,["system:role:edit"]]])]),_:2},1032,["onCommand"])):J("",!0)]),_:1})]),_:1},8,["data"])),[[el,M.value]]),f(t(We,{total:L.value,page:d(c).page_num,"onUpdate:page":e[5]||(e[5]=l=>d(c).page_num=l),limit:d(c).page_size,"onUpdate:limit":e[6]||(e[6]=l=>d(c).page_size=l),onPagination:C},null,8,["total","page","limit"]),[[I,L.value>0]]),t(_e,{title:R.value,modelValue:x.value,"onUpdate:modelValue":e[18]||(e[18]=l=>x.value=l),width:"500px","append-to-body":""},{footer:o(()=>[$("div",ql,[t(y,{type:"primary",onClick:Ae},{default:o(()=>[El]),_:1}),t(y,{onClick:Te},{default:o(()=>[Ml]),_:1})])]),default:o(()=>[t(H,{ref:"roleRef",model:d(n),rules:d(we),"label-width":"100px"},{default:o(()=>[t(s,{label:"\u89D2\u8272\u540D\u79F0",prop:"role_name"},{default:o(()=>[t(p,{modelValue:d(n).role_name,"onUpdate:modelValue":e[7]||(e[7]=l=>d(n).role_name=l),placeholder:"\u8BF7\u8F93\u5165\u89D2\u8272\u540D\u79F0"},null,8,["modelValue"])]),_:1}),t(s,{prop:"role_key"},{label:o(()=>[$("span",null,[t(Ge,{content:"\u63A7\u5236\u5668\u4E2D\u5B9A\u4E49\u7684\u6743\u9650\u5B57\u7B26\uFF0C\u5982\uFF1A@PreAuthorize(`@ss.hasRole('admin')`)",placement:"top"},{default:o(()=>[$l]),_:1}),Nl])]),default:o(()=>[t(p,{modelValue:d(n).role_key,"onUpdate:modelValue":e[8]||(e[8]=l=>d(n).role_key=l),placeholder:"\u8BF7\u8F93\u5165\u6743\u9650\u5B57\u7B26"},null,8,["modelValue"])]),_:1}),t(s,{label:"\u89D2\u8272\u987A\u5E8F",prop:"list_order"},{default:o(()=>[t(Je,{modelValue:d(n).list_order,"onUpdate:modelValue":e[9]||(e[9]=l=>d(n).list_order=l),"controls-position":"right",min:0},null,8,["modelValue"])]),_:1}),t(s,{label:"\u72B6\u6001"},{default:o(()=>[t(Ze,{modelValue:d(n).status,"onUpdate:modelValue":e[10]||(e[10]=l=>d(n).status=l)},{default:o(()=>[(_(!0),K(W,null,G(d(X),l=>(_(),v(Xe,{key:l.value,label:l.value},{default:o(()=>[i(ge(l.label),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])]),_:1}),t(s,{label:"\u83DC\u5355\u6743\u9650"},{default:o(()=>[t(S,{modelValue:F.value,"onUpdate:modelValue":e[11]||(e[11]=l=>F.value=l),onChange:e[12]||(e[12]=l=>de(l,"menu"))},{default:o(()=>[Al]),_:1},8,["modelValue"]),t(S,{modelValue:O.value,"onUpdate:modelValue":e[13]||(e[13]=l=>O.value=l),onChange:e[14]||(e[14]=l=>se(l,"menu"))},{default:o(()=>[Tl]),_:1},8,["modelValue"]),t(S,{modelValue:d(n).menuCheckStrictly,"onUpdate:modelValue":e[15]||(e[15]=l=>d(n).menuCheckStrictly=l),onChange:e[16]||(e[16]=l=>ue(l,"menu"))},{default:o(()=>[jl]),_:1},8,["modelValue"]),t(pe,{class:"tree-border",data:A.value,"show-checkbox":"",ref_key:"menuRef",ref:b,"node-key":"id","check-strictly":!d(n).menuCheckStrictly,"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019",props:{label:"menu_name",children:"children"}},null,8,["data","check-strictly"])]),_:1}),t(s,{label:"\u5907\u6CE8"},{default:o(()=>[t(p,{modelValue:d(n).remark,"onUpdate:modelValue":e[17]||(e[17]=l=>d(n).remark=l),type:"textarea",placeholder:"\u8BF7\u8F93\u5165\u5185\u5BB9"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue"]),t(_e,{title:R.value,modelValue:D.value,"onUpdate:modelValue":e[28]||(e[28]=l=>D.value=l),width:"500px","append-to-body":""},{footer:o(()=>[$("div",Fl,[t(y,{type:"primary",onClick:Ee},{default:o(()=>[Ol]),_:1}),t(y,{onClick:Me},{default:o(()=>[Ql]),_:1})])]),default:o(()=>[t(H,{model:d(n),"label-width":"80px"},{default:o(()=>[t(s,{label:"\u89D2\u8272\u540D\u79F0"},{default:o(()=>[t(p,{modelValue:d(n).role_name,"onUpdate:modelValue":e[19]||(e[19]=l=>d(n).role_name=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(s,{label:"\u6743\u9650\u5B57\u7B26"},{default:o(()=>[t(p,{modelValue:d(n).role_key,"onUpdate:modelValue":e[20]||(e[20]=l=>d(n).role_key=l),disabled:!0},null,8,["modelValue"])]),_:1}),t(s,{label:"\u6743\u9650\u8303\u56F4"},{default:o(()=>[t(ie,{modelValue:d(n).data_scope,"onUpdate:modelValue":e[21]||(e[21]=l=>d(n).data_scope=l),onChange:je},{default:o(()=>[(_(!0),K(W,null,G(Ve.value,l=>(_(),v(q,{key:l.value,label:l.label,value:l.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),f(t(s,{label:"\u6570\u636E\u6743\u9650"},{default:o(()=>[t(S,{modelValue:Q.value,"onUpdate:modelValue":e[22]||(e[22]=l=>Q.value=l),onChange:e[23]||(e[23]=l=>de(l,"dept"))},{default:o(()=>[Pl]),_:1},8,["modelValue"]),t(S,{modelValue:Y.value,"onUpdate:modelValue":e[24]||(e[24]=l=>Y.value=l),onChange:e[25]||(e[25]=l=>se(l,"dept"))},{default:o(()=>[Bl]),_:1},8,["modelValue"]),t(S,{modelValue:d(n).deptCheckStrictly,"onUpdate:modelValue":e[26]||(e[26]=l=>d(n).deptCheckStrictly=l),onChange:e[27]||(e[27]=l=>ue(l,"dept"))},{default:o(()=>[Ll]),_:1},8,["modelValue"]),t(pe,{class:"tree-border",data:T.value,"show-checkbox":"","default-expand-all":"",ref_key:"deptRef",ref:V,"node-key":"dept_id","check-strictly":!d(n).deptCheckStrictly,"empty-text":"\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019",props:{label:"dept_name",children:"children"}},null,8,["data","check-strictly"])]),_:1},512),[[I,d(n).data_scope==2]])]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}});export{Zl as default};
