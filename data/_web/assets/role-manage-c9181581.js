import{s as e,r as u,p as l,e as t,d as a,c as o}from"./index-174ad176.js";import{i as n,q as r,p as V,k as i,m as s,E as c}from"./index.js";import{u as d,P as m,a as f}from"./pagination-87b07e34.js";import{R as p}from"./right-tool-bar-f10e816b.js";import{u as E}from"./useFormUtil-98c17c20.js";import{h}from"./usePermission-16d8d5ac.js";import{u as _}from"./useTableUtil-0e4d2f9a.js";import{s as v}from"./constDynamicRoutes-5c9c22de.js";import{d as C}from"./dict-2940434e.js";import{_ as w}from"./role-manage-data-scope-dialog.vue_vue_type_script_setup_true_lang-575c49d9.js";import{_ as g}from"./role-manage-dialog.vue_vue_type_script_setup_true_lang-bab604f6.js";import"./_plugin-vue_export-helper-0909ef10.js";const k=Vue.defineComponent({name:v.roleManage.path}),y=Vue.defineComponent({...k,setup(v){const{t:k}=VueI18n.useI18n({useScope:"global"}),y=Vue.ref(!0),b=Vue.ref(),N=n(C.sysNormalDisable),P=Vue.ref(!1),x=Vue.ref(!1),B=Vue.ref(""),T=Vue.ref({}),{useTableSelectChange:S}=_(),{formReset:D}=E(),j=Vue.ref([]),U=Vue.ref({page_size:10,page_num:1}),{list:F,getListFn:I,total:K}=d(r.getList,U),{handleSelectionChangeFn:M,ids:$,values:R,single:Y,selected:z}=S(),L=e=>M(e,"role_id","role_name"),q=()=>{T.value={status:"1"},B.value="新增角色",P.value=!0},Q=async e=>{if(null==e?void 0:e.role_id)T.value=e;else{const{data:e,execute:u}=i(r.getById,{role_id:$.value[0]});await u(),T.value=e.value}B.value=`更新角色-${T.value.role_name}`,P.value=!0},O=async e=>{await f(r.delete,"role_id",$,"role_name",R,"role_ids",e)&&await I()},A=()=>{D(b.value),I()},G=()=>{P.value=!1,x.value=!1,I()};return(n,i)=>(Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.withDirectives(Vue.createVNode(Vue.unref(ElementPlus.ElForm),{ref_key:"queryRef",ref:b,inline:!0,model:U.value,class:"base-form","label-width":"68px"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"角色名称",prop:"role_name"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:U.value.role_name,"onUpdate:modelValue":i[0]||(i[0]=e=>U.value.role_name=e),clearable:"",placeholder:"请输入角色名称",onKeyup:Vue.withKeys(Vue.unref(I),["enter"])},null,8,["modelValue","onKeyup"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"权限字符",prop:"role_key"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:U.value.role_key,"onUpdate:modelValue":i[1]||(i[1]=e=>U.value.role_key=e),clearable:"",placeholder:"请输入权限字符",onKeyup:Vue.withKeys(Vue.unref(I),["enter"])},null,8,["modelValue","onKeyup"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"角色状态",prop:"status"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElSelect),{modelValue:U.value.status,"onUpdate:modelValue":i[2]||(i[2]=e=>U.value.status=e),clearable:"",placeholder:"角色状态"},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(N)[Vue.unref(C).sysNormalDisable],(e=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElOption),{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"创建时间"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElDatePicker),{modelValue:j.value,"onUpdate:modelValue":i[3]||(i[3]=e=>j.value=e),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),null,{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{icon:Vue.unref(e),type:"primary",onClick:Vue.unref(I)},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(k)("common.search")),1)])),_:1},8,["icon","onClick"]),Vue.createVNode(Vue.unref(ElementPlus.ElButton),{icon:Vue.unref(u),onClick:A},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(k)("common.reset")),1)])),_:1},8,["icon"])])),_:1})])),_:1},8,["model"]),[[Vue.vShow,y.value]]),Vue.createVNode(Vue.unref(ElementPlus.ElRow),{gutter:10,class:"m-b-8px",style:{height:"35px"}},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:1.5},{default:Vue.withCtx((()=>[Vue.unref(h)(Vue.unref(r).add)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElButton),{key:0,icon:Vue.unref(l),plain:"",type:"primary",onClick:q},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(k)("common.add")),1)])),_:1},8,["icon"])):Vue.createCommentVNode("",!0)])),_:1},8,["span"]),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:1.5},{default:Vue.withCtx((()=>[Vue.unref(h)(Vue.unref(r).edit)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElButton),{key:0,disabled:!Vue.unref(Y),icon:Vue.unref(t),plain:"",type:"success",onClick:i[4]||(i[4]=e=>Q())},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(k)("common.edit")),1)])),_:1},8,["disabled","icon"])):Vue.createCommentVNode("",!0)])),_:1},8,["span"]),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:1.5},{default:Vue.withCtx((()=>[Vue.unref(h)(Vue.unref(r).delete)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElButton),{key:0,disabled:!Vue.unref(z),icon:Vue.unref(a),plain:"",type:"danger",onClick:i[5]||(i[5]=e=>O())},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(k)("common.delete")),1)])),_:1},8,["disabled","icon"])):Vue.createCommentVNode("",!0)])),_:1},8,["span"]),Vue.createVNode(p,{showSearch:y.value,"onUpdate:showSearch":i[6]||(i[6]=e=>y.value=e),onQueryTable:Vue.unref(I)},null,8,["showSearch","onQueryTable"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElTable),{data:Vue.unref(F),onSelectionChange:L,"tooltip-effect":"light"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{type:"selection",width:"55",align:"center"}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"角色编号",prop:"role_id","show-overflow-tooltip":""}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"角色名称",prop:"role_name","show-overflow-tooltip":!0,width:"150"}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"权限字符",prop:"role_key","show-overflow-tooltip":!0,width:"150"}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"显示顺序",prop:"list_order",width:"100"}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"状态",align:"center",width:"100"},{default:Vue.withCtx((e=>[Vue.createVNode(Vue.unref(ElementPlus.ElSwitch),{modelValue:e.row.status,"onUpdate:modelValue":u=>e.row.status=u,"active-value":"1","inactive-value":"0",disabled:!Vue.unref(h)(Vue.unref(r).changeStatus),onChange:u=>(async e=>{const u="1"===e.status?"启用":"停用";await ElementPlus.ElMessageBox.confirm(`确定要  ${u}  ${e.role_name}  吗?`,"角色状态",{type:"warning"}).then((async()=>{const{data:l,execute:t}=s(r.changeStatus,{role_id:e.role_id,status:e.status});await t(),l.value!==c&&(ElementPlus.ElMessage.success(`你成功 ${u} 用户 ${e.role_name}`),I())})).catch((()=>{ElementPlus.ElMessage.info("你取消了操作"),e.status="0"===e.status?"1":"0"}))})(e.row)},null,8,["modelValue","onUpdate:modelValue","disabled","onChange"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"创建时间",align:"center",prop:"created_at",width:"180"},{default:Vue.withCtx((e=>[Vue.createElementVNode("span",null,Vue.toDisplayString(Vue.unref(V)(e.row.created_at)),1)])),_:1}),Vue.unref(h)(Vue.unref(r).edit,Vue.unref(r).delete)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElTableColumn),{key:0,align:"center",label:"操作",width:"150px"},{default:Vue.withCtx((e=>[Vue.unref(h)(Vue.unref(r).edit)&&1!==e.row.role_id?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElTooltip),{key:0,content:"修改",placement:"top",effect:"light"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{link:"",icon:Vue.unref(t),onClick:u=>Q(e.row)},null,8,["icon","onClick"])])),_:2},1024)):Vue.createCommentVNode("",!0),Vue.unref(h)(Vue.unref(r).delete)&&1!==e.row.role_id?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElTooltip),{key:1,content:"删除",placement:"top",effect:"light"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{link:"",icon:Vue.unref(a),onClick:u=>O(e.row)},null,8,["icon","onClick"])])),_:2},1024)):Vue.createCommentVNode("",!0),Vue.unref(h)(Vue.unref(r).setDataScope)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElTooltip),{key:2,content:"数据权限",placement:"top",effect:"light"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{link:"",icon:Vue.unref(o),onClick:u=>{return l=e.row,T.value=l,B.value=`更新数据权限-${l.role_name}`,void(x.value=!0);var l}},null,8,["icon","onClick"])])),_:2},1024)):Vue.createCommentVNode("",!0)])),_:1})):Vue.createCommentVNode("",!0)])),_:1},8,["data"]),Vue.withDirectives(Vue.createVNode(m,{limit:U.value.page_size,"onUpdate:limit":i[7]||(i[7]=e=>U.value.page_size=e),page:U.value.page_num,"onUpdate:page":i[8]||(i[8]=e=>U.value.page_num=e),total:Vue.unref(K),onPagination:Vue.unref(I)},null,8,["limit","page","total","onPagination"]),[[Vue.vShow,Vue.unref(K)>0]]),P.value?(Vue.openBlock(),Vue.createBlock(g,{key:0,open:P.value,"role-data":T.value,title:B.value,onCloseDialog:G},null,8,["open","role-data","title"])):Vue.createCommentVNode("",!0),x.value?(Vue.openBlock(),Vue.createBlock(w,{key:1,"open-data-scope":x.value,"role-data":T.value,title:B.value,onCloseDialog:G},null,8,["open-data-scope","role-data","title"])):Vue.createCommentVNode("",!0)]))}});export{y as default};
