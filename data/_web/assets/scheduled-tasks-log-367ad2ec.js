import{s as e,r as l,d as u,b as t,v as a}from"./index-174ad176.js";import{i as o,I as n,J as r,p as V,k as s,H as i,l as c,x as d,y as m}from"./index.js";import{D as f}from"./dict-tag-15f2a908.js";import{P as p,a as E}from"./pagination-87b07e34.js";import{R as v}from"./right-tool-bar-f10e816b.js";import{E as b}from"./useTabBar-7d8415a5.js";import{u as _}from"./useFormUtil-98c17c20.js";import{h as g}from"./usePermission-16d8d5ac.js";import{u as h}from"./useTableUtil-0e4d2f9a.js";import{d as w}from"./dict-2940434e.js";import"./_plugin-vue_export-helper-0909ef10.js";const C=Vue.defineComponent({name:"dict-data"}),N=Vue.defineComponent({...C,setup(C){const N=o(w.sysTaskIsOnce,w.sysCommonStatus,w.sysJobGroup),{t:x}=VueI18n.useI18n({useScope:"global"}),P=VueRouter.useRoute(),{useTableSelectChange:y}=h(),{formReset:k}=_(),{handleSelectionChangeFn:j,ids:T,values:B,selected:S}=y(),D=e=>j(e,"job_log_id","job_log_id"),F=Vue.ref([]),I=Vue.ref({}),U=Vue.ref(!0),M=Vue.ref(),L=Vue.ref(!1),R=Vue.ref(""),O=Vue.ref({page_num:1,page_size:10}),z=Vue.ref(""),G=Vue.ref(""),J=Vue.ref(0),Y=Vue.ref([]),A=Vue.ref({}),q=async()=>{var e,l;const{data:u,execute:t}=s(r.getList,O);await t(),Y.value=null==(e=u.value)?void 0:e.list,J.value=null==(l=u.value)?void 0:l.total},H=async()=>{const e=O.value.job_id;if("all"===e)return ElementPlus.ElMessage.info("当前选择为ALL,无法清除");await ElementPlus.ElMessageBox.confirm("是否确认清空当前的任务日志?","清空确认",{type:"warning"}).then((async()=>{const{execute:l}=c(r.clean,{job_id:e});await l(),ElementPlus.ElMessage.success("清空登录日志成功")})).catch((()=>{ElementPlus.ElMessage.info("取消情况操作")})),q()},Q=e=>{z.value=I.value[e].job_group,G.value=I.value[e].job_name,q()},{pause:X,resume:K}=n((()=>q()),1500),W=Vue.ref(!1),Z=e=>{e?K():X()},$=()=>{k(M.value),q()},ee=()=>{d.back(),m(b.current)};return Vue.onMounted((async()=>{await(async()=>{var e;const l={page_num:1,page_size:Number.MAX_SAFE_INTEGER},{data:u,execute:t}=s(i.getList,l);await t();let a={};null==(e=u.value)||e.list.forEach((e=>{a[e.job_id]=e})),I.value=a;const o=P.query.job_id;O.value.job_id=o,z.value=I.value[o].job_group,G.value=I.value[o].job_name})(),await q(),W.value?K():X()})),(o,n)=>{const s=Vue.resolveComponent("el-divider"),i=Vue.resolveComponent("el-checkbox");return Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.createVNode(Vue.unref(ElementPlus.ElForm),null,{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"任务信息",prop:"job_group"},{default:Vue.withCtx((()=>[Vue.createVNode(f,{options:Vue.unref(N)[Vue.unref(w).sysJobGroup],value:z.value},null,8,["options","value"]),Vue.createElementVNode("span",null,Vue.toDisplayString(G.value),1)])),_:1})])),_:1}),Vue.createVNode(s,{class:"m-0"}),Vue.withDirectives(Vue.createVNode(Vue.unref(ElementPlus.ElForm),{ref_key:"queryRef",ref:M,inline:!0,model:O.value,"label-width":"68px",class:"base-form"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"任务ID",prop:"job_id"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElSelect),{modelValue:O.value.job_id,"onUpdate:modelValue":n[0]||(n[0]=e=>O.value.job_id=e),placeholder:"请任务组名",clearable:"",onChange:Q},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(I.value,((e,l)=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElOption),{key:l,label:e.task_id,value:l},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"执行状态",prop:"status"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElSelect),{modelValue:O.value.status,"onUpdate:modelValue":n[1]||(n[1]=e=>O.value.status=e),placeholder:"请选择执行状态",clearable:""},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(N)[Vue.unref(w).sysCommonStatus],(e=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElOption),{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"任务属性",prop:"is_once"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElSelect),{modelValue:O.value.is_once,"onUpdate:modelValue":n[2]||(n[2]=e=>O.value.is_once=e),placeholder:"请选择任务属性",clearable:""},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(N)[Vue.unref(w).sysTaskIsOnce],(e=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElOption),{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"执行时间"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElDatePicker),{modelValue:F.value,"onUpdate:modelValue":n[3]||(n[3]=e=>F.value=e),"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),null,{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{icon:Vue.unref(e),type:"primary",onClick:q},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(x)("common.search")),1)])),_:1},8,["icon"]),Vue.createVNode(Vue.unref(ElementPlus.ElButton),{icon:Vue.unref(l),onClick:$},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(x)("common.reset")),1)])),_:1},8,["icon"])])),_:1})])),_:1},8,["model"]),[[Vue.vShow,U.value]]),Vue.createVNode(Vue.unref(ElementPlus.ElRow),{gutter:10,class:"m-b-8px",style:{height:"35px"}},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:1.5},{default:Vue.withCtx((()=>[Vue.unref(g)(Vue.unref(r).delete)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElButton),{key:0,type:"danger",plain:"",icon:Vue.unref(u),disabled:!Vue.unref(S),onClick:n[4]||(n[4]=e=>(async e=>{await E(r.delete,"job_log_id",T,"job_log_id",B,"job_log_ids",e)&&q()})())},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(x)("common.delete")),1)])),_:1},8,["icon","disabled"])):Vue.createCommentVNode("",!0)])),_:1},8,["span"]),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:1.5},{default:Vue.withCtx((()=>[Vue.unref(g)(Vue.unref(r).clean)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElButton),{key:0,type:"danger",plain:"",icon:Vue.unref(u),onClick:H},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(x)("common.clean")),1)])),_:1},8,["icon"])):Vue.createCommentVNode("",!0)])),_:1},8,["span"]),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:1.5},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{type:"warning",plain:"",icon:Vue.unref(t),onClick:ee},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(x)("common.close")),1)])),_:1},8,["icon"])])),_:1},8,["span"]),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:1.5},{default:Vue.withCtx((()=>[Vue.createVNode(i,{modelValue:W.value,"onUpdate:modelValue":n[5]||(n[5]=e=>W.value=e),border:"",label:Vue.unref(x)("common.auto")+Vue.unref(x)("common.reFresh"),onChange:Z},null,8,["modelValue","label"])])),_:1},8,["span"]),Vue.createVNode(v,{showSearch:U.value,"onUpdate:showSearch":n[6]||(n[6]=e=>U.value=e),onQueryTable:q},null,8,["showSearch"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElTable),{data:Y.value,onSelectionChange:D,"tooltip-effect":"light"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{type:"selection",width:"55",align:"center"}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"日志编号",width:"80",align:"center",prop:"job_log_id","show-overflow-tooltip":""}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"任务名称",align:"center",prop:"job_name","show-overflow-tooltip":!0}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"任务组名",align:"center",prop:"job_group","show-overflow-tooltip":!0},{default:Vue.withCtx((e=>[Vue.createVNode(f,{options:Vue.unref(N)[Vue.unref(w).sysJobGroup],value:e.row.job_group},null,8,["options","value"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"批ID",align:"center",prop:"lot_id","show-overflow-tooltip":!0}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"批内序",align:"center",prop:"lot_order","show-overflow-tooltip":!0}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"调用目标字符串",align:"center",prop:"invoke_target","show-overflow-tooltip":!0}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"日志信息",align:"center",prop:"job_message","show-overflow-tooltip":!0}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"执行状态",align:"center",prop:"status"},{default:Vue.withCtx((e=>[Vue.createVNode(f,{options:Vue.unref(N)[Vue.unref(w).sysCommonStatus],value:e.row.status},null,8,["options","value"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"任务属性",align:"center",prop:"is_once"},{default:Vue.withCtx((e=>[Vue.createVNode(f,{options:Vue.unref(N)[Vue.unref(w).sysTaskIsOnce],value:e.row.is_once},null,8,["options","value"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"执行时间",align:"center",prop:"created_at",width:"180"},{default:Vue.withCtx((e=>[Vue.createElementVNode("span",null,Vue.toDisplayString(Vue.unref(V)(e.row.created_at)),1)])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:Vue.withCtx((e=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{link:"",icon:Vue.unref(a),onClick:l=>{return u=e.row,A.value=u,R.value="任务日志详情",void(L.value=!0);var u}},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(x)("common.detail")),1)])),_:2},1032,["icon","onClick"])])),_:1})])),_:1},8,["data"]),Vue.withDirectives(Vue.createVNode(p,{page:O.value.page_num,"onUpdate:page":n[7]||(n[7]=e=>O.value.page_num=e),limit:O.value.page_size,"onUpdate:limit":n[8]||(n[8]=e=>O.value.page_size=e),total:J.value,onPagination:q},null,8,["page","limit","total"]),[[Vue.vShow,J.value>0]])])}}});export{N as default};
