import{i as e,s as l,m as u,j as t,E as a,n as r,k as o,q as d,o as n}from"./index.js";import{u as V}from"./useFormUtil-98c17c20.js";import{d as s}from"./dict-2940434e.js";const i={class:"dialog-footer"},m=Vue.defineComponent({__name:"user-manage-dialog",props:{userId:{type:String,default:"",required:!0},open:{type:Boolean,default:!1},title:{type:String,default:""}},emits:["closeDialog"],setup(m,{emit:c}){const p=m,f=Vue.ref({}),E=Vue.inject("deptTree"),_=Vue.ref([]),v=Vue.ref([]),h=Vue.ref(),{formValidate:g}=V(),{t:w}=VueI18n.useI18n({useScope:"global"}),x={value:"dept_id",label:"dept_name",checkStrictly:!0},C=e(s.sysNormalDisable,s.isAdmin,s.sysUserSex),P=Vue.ref({user_name:[{required:!0,message:"用户名称不能为空",trigger:"blur"},{min:2,max:20,message:"用户名称长度必须介于 2 和 20 之间",trigger:"blur"}],user_nickname:[{required:!0,message:"用户昵称不能为空",trigger:"blur"}],user_password:[{required:!0,message:"用户密码不能为空",trigger:"blur"},{min:5,max:32,message:"用户密码长度必须介于 5 和 32 之间",trigger:"blur"}],user_email:[{type:"email",message:"请输入正确的邮箱地址",trigger:"blur"}],sex:[{required:!0,message:"用户性别不能为空",trigger:"change"}],post_ids:[{required:!0,message:"用户岗位不能为空",trigger:"change"}],dept_ids:[{validator:(e,l,u)=>{var t;""===l||0===l.length?u(new Error("用户部门不能为空")):(f.value.dept_id&&(null==(t=h.value)||t.validateField("dept_id",(()=>null))),u())},required:!0,trigger:"change"}],dept_id:[{validator:(e,l,u)=>{""===l?u(new Error("激活部门不能为空")):f.value.dept_ids.includes(f.value.dept_id)?u():u(new Error("激活部门必须在已选择部门内选择"))},required:!0,trigger:"change"}],role_ids:[{validator:(e,l,u)=>{var t;""===l||0===l.length?u(new Error("用户角色不能为空")):(f.value.role_id&&(null==(t=h.value)||t.validateField("role_id",(()=>null))),u())},required:!0,trigger:"change"}],role_id:[{validator:(e,l,u)=>{""===l?u(new Error("激活角色不能为空")):f.value.role_ids.includes(f.value.role_id)?u():u(new Error("激活角色必须在已选择角色内选择"))},required:!0,trigger:"change"}]});(async()=>{var e,l,u,a;if(""===p.userId)f.value={user_status:"1",is_admin:"1"};else{const{data:r,execute:d}=o(t.getById,{user_id:p.userId});await d(),f.value=null==(e=r.value)?void 0:e.user_info,f.value.post_ids=null==(l=r.value)?void 0:l.post_ids,f.value.role_ids=null==(u=r.value)?void 0:u.role_ids,f.value.dept_ids=null==(a=r.value)?void 0:a.dept_ids}})(),(async()=>{var e,l,u;let t={page_num:1,page_size:Number.MAX_SAFE_INTEGER};const{data:a,execute:r}=o(d.getList,t),{data:V,execute:s}=o(n.getList,t);await Promise.all([r(),s()]),_.value=null==(e=a.value)?void 0:e.list,v.value=null==(l=V.value)?void 0:l.list,null==(u=h.value)||u.clearValidate()})();const N=()=>{c("closeDialog")};return(e,o)=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElDialog),{modelValue:m.open,"onUpdate:modelValue":o[15]||(o[15]=e=>Vue.isRef(open)?open.value=e:null),title:m.title,width:"680px","before-close":N,"append-to-body":""},{footer:Vue.withCtx((()=>[Vue.createElementVNode("div",i,[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{type:"primary",onClick:o[14]||(o[14]=e=>(async e=>{if(await g(e))if(f.value.id){let e={...f.value};e.user_password=l(f.value.user_password);const{data:r,execute:o}=u(t.edit,e);if(await o(),r.value===a)return;ElementPlus.ElMessage.success(`成功更新用户 ${f.value.user_name}`),N()}else{let e={...f.value};e.user_password=l(f.value.user_password);const{data:u,execute:o}=r(t.add,e);if(await o(),u.value===a)return;ElementPlus.ElMessage.success(`成功新增用户 ${f.value.user_name}`),N()}})(h.value))},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(w)("common.submit")),1)])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElButton),{onClick:N},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(w)("common.cancel")),1)])),_:1})])])),default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElForm),{ref_key:"userRef",ref:h,model:f.value,rules:P.value,"label-width":"80px",class:"base-form"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElRow),{gutter:20},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[void 0===f.value.id?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElFormItem),{key:0,label:"用户名称",prop:"user_name"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:f.value.user_name,"onUpdate:modelValue":o[0]||(o[0]=e=>f.value.user_name=e),placeholder:"请输入用户名称",maxlength:"30"},null,8,["modelValue"])])),_:1})):Vue.createCommentVNode("",!0)])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[void 0===f.value.id?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElFormItem),{key:0,label:"用户密码",prop:"user_password"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:f.value.user_password,"onUpdate:modelValue":o[1]||(o[1]=e=>f.value.user_password=e),placeholder:"请输入用户密码",type:"password",maxlength:"32","show-password":""},null,8,["modelValue"])])),_:1})):Vue.createCommentVNode("",!0)])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElRow),{gutter:20},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"用户昵称",prop:"user_nickname"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:f.value.user_nickname,"onUpdate:modelValue":o[2]||(o[2]=e=>f.value.user_nickname=e),placeholder:"请输入用户昵称",maxlength:"30"},null,8,["modelValue"])])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"用户性别",prop:"sex"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElSelect),{modelValue:f.value.sex,"onUpdate:modelValue":o[3]||(o[3]=e=>f.value.sex=e),placeholder:"请选择用户性别"},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(C)[Vue.unref(s).sysUserSex],(e=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElOption),{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElRow),{gutter:20},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"用户部门",prop:"dept_ids"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElTreeSelect),{modelValue:f.value.dept_ids,"onUpdate:modelValue":o[4]||(o[4]=e=>f.value.dept_ids=e),data:Vue.unref(E),props:x,"check-strictly":"","render-after-expand":!1,placeholder:"请选择部门",filterable:"",multiple:"","collapse-tags":""},null,8,["modelValue","data"])])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"激活部门",prop:"dept_id"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElTreeSelect),{modelValue:f.value.dept_id,"onUpdate:modelValue":o[5]||(o[5]=e=>f.value.dept_id=e),data:Vue.unref(E),props:x,"check-strictly":"","render-after-expand":!1,placeholder:"请选择激活部门",clearable:"",filterable:""},null,8,["modelValue","data"])])),_:1})])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElRow),{gutter:20},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"用户角色",prop:"role_ids"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElSelect),{modelValue:f.value.role_ids,"onUpdate:modelValue":o[6]||(o[6]=e=>f.value.role_ids=e),multiple:"","collapse-tags":"",placeholder:"请选择用户角色"},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(_.value,(e=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElOption),{key:e.role_id,label:e.role_name,value:e.role_id,disabled:"0"==e.status},null,8,["label","value","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"激活角色",prop:"role_id"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElSelect),{modelValue:f.value.role_id,"onUpdate:modelValue":o[7]||(o[7]=e=>f.value.role_id=e),placeholder:"请选择激活角色"},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(_.value,(e=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElOption),{key:e.role_id,label:e.role_name,value:e.role_id,disabled:!f.value.role_ids.includes(e.role_id)},null,8,["label","value","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElRow),{gutter:20},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"手机号码",prop:"phone_num"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:f.value.phone_num,"onUpdate:modelValue":o[8]||(o[8]=e=>f.value.phone_num=e),placeholder:"请输入手机号码",maxlength:"11"},null,8,["modelValue"])])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"用户邮箱",prop:"email"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:f.value.user_email,"onUpdate:modelValue":o[9]||(o[9]=e=>f.value.user_email=e),placeholder:"请输入邮箱",maxlength:"50"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElRow),{gutter:20},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"用户岗位",prop:"post_ids"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElSelect),{modelValue:f.value.post_ids,"onUpdate:modelValue":o[10]||(o[10]=e=>f.value.post_ids=e),multiple:"","collapse-tags":"",placeholder:"请选择用户岗位"},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(v.value,(e=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElOption),{key:e.post_id,label:e.post_name,value:e.post_id,disabled:"0"==e.status},null,8,["label","value","disabled"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElRow),{gutter:20},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"后台用户"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElRadioGroup),{modelValue:f.value.is_admin,"onUpdate:modelValue":o[11]||(o[11]=e=>f.value.is_admin=e)},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(C)[Vue.unref(s).isAdmin],(e=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElRadio),{key:e.value,label:e.value},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(e.label),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:12},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"用户状态"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElRadioGroup),{modelValue:f.value.user_status,"onUpdate:modelValue":o[12]||(o[12]=e=>f.value.user_status=e)},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(C)[Vue.unref(s).sysNormalDisable],(e=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElRadio),{key:e.value,label:e.value},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(e.label),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElRow),null,{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:24},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"备注"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:f.value.remark,"onUpdate:modelValue":o[13]||(o[13]=e=>f.value.remark=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue","title"]))}});export{m as _};
