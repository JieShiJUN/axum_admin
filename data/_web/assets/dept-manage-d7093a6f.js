import{s as e,r as u,p as t,a as l,e as a,d as n}from"./index-174ad176.js";import{i as o,A as r,p as V,j as d,k as s,l as c}from"./index.js";import{D as i}from"./dict-tag-15f2a908.js";import{R as m}from"./right-tool-bar-f10e816b.js";import{u as p}from"./useFormUtil-98c17c20.js";import{h as f}from"./usePermission-16d8d5ac.js";import{s as E}from"./constDynamicRoutes-5c9c22de.js";import{d as h}from"./dict-2940434e.js";import{_ as v}from"./dept-manage-dialog.vue_vue_type_script_setup_true_lang-e4ca7972.js";import"./_plugin-vue_export-helper-0909ef10.js";const C=Vue.defineComponent({name:E.deptManage.path}),_=Vue.defineComponent({...C,setup(E){const{t:C}=VueI18n.useI18n({useScope:"global"}),_=Vue.ref(!0),k=Vue.ref(),w=Vue.ref(!0),x=Vue.ref(!0),y=o(h.sysNormalDisable),N=Vue.ref({}),b=Vue.ref([]),g=Vue.ref(!1),B=Vue.ref(""),P=Vue.ref({status:"1"}),{formReset:T}=p(),D=async()=>{const{data:e,execute:u}=s(r.getDeptTree);await u(),b.value=e.value},S=()=>{x.value=!x.value,w.value=!1,Vue.nextTick((()=>{w.value=!0}))},j=e=>{(null==e?void 0:e.dept_id)?P.value.parent_id=e.dept_id:P.value={status:"1"},B.value=C("dept.add"),g.value=!0},F=()=>{g.value=!1,D()},I=()=>{T(k.value),D()};return D(),(o,s)=>(Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.withDirectives(Vue.createVNode(Vue.unref(ElementPlus.ElForm),{ref_key:"queryRef",ref:k,inline:!0,model:N.value,class:"base-form"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:Vue.unref(C)("dept.name"),prop:"dept_name"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:N.value.dept_name,"onUpdate:modelValue":s[0]||(s[0]=e=>N.value.dept_name=e),clearable:"",placeholder:Vue.unref(C)("dept.name"),onKeyup:Vue.withKeys(D,["enter"])},null,8,["modelValue","placeholder","onKeyup"])])),_:1},8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:Vue.unref(C)("dept.status"),prop:"status"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElSelect),{modelValue:N.value.status,"onUpdate:modelValue":s[1]||(s[1]=e=>N.value.status=e),clearable:"",placeholder:Vue.unref(C)("dept.status")},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(y)[Vue.unref(h).sysNormalDisable],(e=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElOption),{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),null,{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{icon:Vue.unref(e),type:"primary",onClick:D},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(C)("common.search")),1)])),_:1},8,["icon"]),Vue.createVNode(Vue.unref(ElementPlus.ElButton),{icon:Vue.unref(u),onClick:I},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(C)("common.reset")),1)])),_:1},8,["icon"])])),_:1})])),_:1},8,["model"]),[[Vue.vShow,_.value]]),Vue.createVNode(Vue.unref(ElementPlus.ElRow),{gutter:10,class:"m-b-8px",style:{height:"35px"}},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:1.5},{default:Vue.withCtx((()=>[Vue.unref(f)(Vue.unref(r).add)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElButton),{key:0,icon:Vue.unref(t),plain:"",type:"primary",onClick:s[2]||(s[2]=e=>j())},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(C)("common.add")),1)])),_:1},8,["icon"])):Vue.createCommentVNode("",!0)])),_:1},8,["span"]),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:1.5},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{icon:Vue.unref(l),plain:"",type:"info",onClick:S},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(C)("common.expand")+"/"+Vue.unref(C)("common.collapse")),1)])),_:1},8,["icon"])])),_:1},8,["span"]),Vue.createVNode(m,{showSearch:_.value,"onUpdate:showSearch":s[3]||(s[3]=e=>_.value=e),onQueryTable:D},null,8,["showSearch"])])),_:1}),w.value?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElTable),{key:0,data:b.value,"default-expand-all":x.value,"tree-props":{children:"children",hasChildren:"hasChildren"},"row-key":"dept_id","tooltip-effect":"light"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:Vue.unref(C)("dept.name"),prop:"dept_name",width:"260"},null,8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:Vue.unref(C)("common.order"),prop:"order_num","show-overflow-tooltip":""},null,8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{label:Vue.unref(C)("common.status"),prop:"status","show-overflow-tooltip":""},{default:Vue.withCtx((e=>[Vue.createVNode(i,{options:Vue.unref(y)[Vue.unref(h).sysNormalDisable],value:e.row.status},null,8,["options","value"])])),_:1},8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{align:"center",label:Vue.unref(C)("common.createTime"),prop:"created_at","show-overflow-tooltip":""},{default:Vue.withCtx((e=>[Vue.createElementVNode("span",null,Vue.toDisplayString(Vue.unref(V)(e.row.created_at)),1)])),_:1},8,["label"]),Vue.unref(f)(Vue.unref(r).add,Vue.unref(d).edit,Vue.unref(r).delete)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElTableColumn),{key:0,align:"center",label:Vue.unref(C)("common.operation"),width:"220px"},{default:Vue.withCtx((e=>[Vue.unref(f)(Vue.unref(r).edit)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElButton),{key:0,icon:Vue.unref(a),link:"",onClick:u=>{return t=e.row,P.value=t,B.value=C("dept.update")+`-${t.dept_name}`,void(g.value=!0);var t}},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(C)("common.edit")),1)])),_:2},1032,["icon","onClick"])):Vue.createCommentVNode("",!0),Vue.unref(f)(Vue.unref(r).add)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElButton),{key:1,icon:Vue.unref(t),link:"",onClick:u=>j(e.row)},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(C)("common.add")),1)])),_:2},1032,["icon","onClick"])):Vue.createCommentVNode("",!0),Vue.unref(f)(Vue.unref(r).delete)&&"0"!==e.row.parent_id?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElButton),{key:2,icon:Vue.unref(n),link:"",onClick:u=>{return t=e.row,void ElementPlus.ElMessageBox.confirm(`是否删除名称为 ${t.dept_name} 的数据？`,"删除确认",{type:"warning"}).then((async()=>{const{execute:e}=c(r.delete,{dept_id:t.dept_id});await e(),ElementPlus.ElMessage.success(`成功删除数据 ${t.dept_name}`),await D()})).catch((()=>{ElementPlus.ElMessage.info(`取消删除数据 ${t.dept_name}`)}));var t}},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(C)("common.delete")),1)])),_:2},1032,["icon","onClick"])):Vue.createCommentVNode("",!0)])),_:1},8,["label"])):Vue.createCommentVNode("",!0)])),_:1},8,["data","default-expand-all"])):Vue.createCommentVNode("",!0),g.value?(Vue.openBlock(),Vue.createBlock(v,{key:1,"dept-data":P.value,"dept-tree":b.value,open:g.value,title:B.value,onCloseDialog:F},null,8,["dept-data","dept-tree","open","title"])):Vue.createCommentVNode("",!0)]))}});export{_ as default};
