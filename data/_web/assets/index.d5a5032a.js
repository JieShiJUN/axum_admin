import{u as e,_ as t,l,B as u,C as a,D as o,E as r,F as n,G as V,H as d,I as i,J as c}from"./index.74f0e013.js";import{t as s}from"./menu.d9e18d07.js";function m(t){if(t&&t instanceof Array&&t.length>0){const l=e().permissions,u=t,a="*:*:*";return!!l.some((e=>a===e||u.includes(e)))}return!1}const p={class:"app-container"},f=Vue.createTextVNode("搜索"),h=Vue.createTextVNode("重置"),v=Vue.createTextVNode("新增"),_=Vue.createTextVNode("修改"),C=Vue.createTextVNode("删除"),w=Vue.createTextVNode("导出"),y=Vue.createTextVNode(' v-model:showSearch="showSearch" @queryTable="getList" >'),x=Vue.createTextVNode(" 权限字符 "),k=Vue.createTextVNode("展开/折叠"),N=Vue.createTextVNode("全选/全不选"),g=Vue.createTextVNode("父子联动"),b={class:"dialog-footer"},B=Vue.createTextVNode("确 定"),D=Vue.createTextVNode("取 消"),S=Vue.createTextVNode("展开/折叠"),U=Vue.createTextVNode("全选/全不选"),T=Vue.createTextVNode("父子联动"),R={class:"dialog-footer"},E=Vue.createTextVNode("确 定"),K=Vue.createTextVNode("取 消"),$=Vue.defineComponent({name:"Role"});var q=t(Object.assign($,{setup(e){const t=VueRouter.useRouter(),{proxy:$}=Vue.getCurrentInstance(),{sys_normal_disable:q}=$.useDict("sys_normal_disable"),F=Vue.ref([]),P=Vue.ref(!1),L=Vue.ref(!0),Y=Vue.ref(!0),z=Vue.ref([]),M=Vue.ref([]),j=Vue.ref(!0),H=Vue.ref(!0),A=Vue.ref(0),I=Vue.ref(""),G=Vue.ref([]),J=Vue.ref([]),O=Vue.ref(!1),Q=Vue.ref(!1),W=Vue.ref(!0),X=Vue.ref(!1),Z=Vue.ref([]),ee=Vue.ref(!1),te=Vue.ref(null),le=Vue.ref(null),ue=Vue.ref([{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}]),ae=Vue.reactive({form:{},queryParams:{page_num:1,page_size:10,role_name:void 0,role_key:void 0,status:void 0},rules:{role_name:[{required:!0,message:"角色名称不能为空",trigger:"blur"}],role_key:[{required:!0,message:"权限字符不能为空",trigger:"blur"}],list_order:[{required:!0,message:"角色顺序不能为空",trigger:"blur"}]}}),{queryParams:oe,form:re,rules:ne}=Vue.toRefs(ae),Ve=async()=>{L.value=!0;const e=await l($.addDateRange(oe.value,G.value));F.value=e.list,A.value=e.total,L.value=!1};function de(){oe.value.page_num=1,Ve()}function ie(){G.value=[],$.resetForm("queryRef"),de()}function ce(e){const t=e.role_id?[e.role_id]:z.value,l=e.role_id?e.role_name:M.value;$.$modal.confirm('是否确认删除角色编号为"'+l+'"的数据项?').then((function(){return u({role_ids:t})})).then((()=>{Ve(),$.$modal.msgSuccess("删除成功")})).catch((()=>{}))}function se(){$.download("system/role/export",{...oe.value},`role_${(new Date).getTime()}.xlsx`)}function me(e){z.value=e.map((e=>e.role_id)),M.value=e.map((e=>e.role_name)),j.value=1!=e.length,H.value=!e.length}async function pe(){J.value=await s()}function fe(){null!=te.value&&te.value.setCheckedKeys([]),O.value=!1,Q.value=!1,W.value=!0,X.value=!1,re.value={role_id:void 0,role_name:void 0,role_key:void 0,list_order:0,status:"1",menu_ids:[],dept_ids:[],menuCheckStrictly:!0,deptCheckStrictly:!1,remark:void 0},$.resetForm("roleRef")}async function he(){fe(),await pe(),P.value=!0,I.value="添加角色"}async function ve(e){fe();const t=e.role_id||z.value[0];await pe();const l=await o({role_id:t}),u=await r({role_id:t});re.value=u,re.value.menuCheckStrictly=!0,re.value.list_order=Number(re.value.list_order),P.value=!0,l.forEach((e=>{Vue.nextTick((()=>{te.value.setChecked(e,!0,!1)}))})),I.value="修改角色"}function _e(e,t){if("menu"==t){let t=J.value;for(let l=0;l<t.length;l++)te.value.store.nodesMap[t[l].id].expanded=e}else if("dept"==t){let t=Z.value;for(let l=0;l<t.length;l++)le.value.store.nodesMap[t[l].id].expanded=e}}function Ce(e,t){"menu"==t?te.value.setCheckedNodes(e?J.value:[]):"dept"==t&&le.value.setCheckedNodes(e?Z.value:[])}function we(e,t){"menu"==t?re.value.menuCheckStrictly=!!e:"dept"==t&&(re.value.deptCheckStrictly=!!e)}function ye(){let e=te.value.getCheckedKeys(),t=te.value.getHalfCheckedKeys();return e.unshift.apply(e,t),e}async function xe(){$.$refs.roleRef.validate((async e=>{e&&(null!=re.value.role_id?(re.value.menu_ids=ye(),await n(re.value),$.$modal.msgSuccess("修改成功"),P.value=!1,Ve()):(re.value.menu_ids=ye(),await V(re.value),$.$modal.msgSuccess("新增成功"),P.value=!1,Ve()))}))}function ke(){P.value=!1,fe()}function Ne(e){"2"!==e&&le.value.setCheckedKeys([])}async function ge(e){fe();const t=e.role_id;await(async()=>{Z.value=await c()})();const l=await d({role_id:t}),u=await r({role_id:t});re.value=u,re.value.deptCheckStrictly=!1,ee.value=!0,Vue.nextTick((()=>{le.value&&le.value.setCheckedKeys(l)})),I.value="分配数据权限"}async function be(){null!=re.value.role_id&&(re.value.dept_ids=function(){let e=le.value.getCheckedKeys(),t=le.value.getHalfCheckedKeys();return e.unshift.apply(e,t),e}(),await i(re.value),$.$modal.msgSuccess("修改成功"),ee.value=!1,Ve())}function Be(){ee.value=!1,fe()}return Ve(),(e,l)=>{const u=Vue.resolveComponent("el-input"),o=Vue.resolveComponent("el-form-item"),r=Vue.resolveComponent("el-option"),n=Vue.resolveComponent("el-select"),V=Vue.resolveComponent("el-date-picker"),d=Vue.resolveComponent("el-button"),i=Vue.resolveComponent("el-form"),c=Vue.resolveComponent("el-col"),s=Vue.resolveComponent("right-toolbar"),z=Vue.resolveComponent("el-row"),M=Vue.resolveComponent("el-table-column"),ae=Vue.resolveComponent("el-switch"),pe=Vue.resolveComponent("el-tooltip"),fe=Vue.resolveComponent("el-table"),ye=Vue.resolveComponent("pagination"),De=Vue.resolveComponent("info-filled"),Se=Vue.resolveComponent("el-icon"),Ue=Vue.resolveComponent("el-input-number"),Te=Vue.resolveComponent("el-radio"),Re=Vue.resolveComponent("el-radio-group"),Ee=Vue.resolveComponent("el-checkbox"),Ke=Vue.resolveComponent("el-tree"),$e=Vue.resolveComponent("el-dialog"),qe=Vue.resolveDirective("hasPermi"),Fe=Vue.resolveDirective("loading");return Vue.openBlock(),Vue.createElementBlock("div",p,[Vue.withDirectives(Vue.createVNode(i,{model:Vue.unref(oe),ref:"queryRef",inline:!0},{default:Vue.withCtx((()=>[Vue.createVNode(o,{label:"角色名称",prop:"role_name"},{default:Vue.withCtx((()=>[Vue.createVNode(u,{modelValue:Vue.unref(oe).role_name,"onUpdate:modelValue":l[0]||(l[0]=e=>Vue.unref(oe).role_name=e),placeholder:"请输入角色名称",clearable:"",style:{width:"240px"},onKeyup:Vue.withKeys(de,["enter"])},null,8,["modelValue","onKeyup"])])),_:1}),Vue.createVNode(o,{label:"权限字符",prop:"role_key"},{default:Vue.withCtx((()=>[Vue.createVNode(u,{modelValue:Vue.unref(oe).role_key,"onUpdate:modelValue":l[1]||(l[1]=e=>Vue.unref(oe).role_key=e),placeholder:"请输入权限字符",clearable:"",style:{width:"240px"},onKeyup:Vue.withKeys(de,["enter"])},null,8,["modelValue","onKeyup"])])),_:1}),Vue.createVNode(o,{label:"状态",prop:"status"},{default:Vue.withCtx((()=>[Vue.createVNode(n,{modelValue:Vue.unref(oe).status,"onUpdate:modelValue":l[2]||(l[2]=e=>Vue.unref(oe).status=e),placeholder:"角色状态",clearable:"",style:{width:"240px"}},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(q),(e=>(Vue.openBlock(),Vue.createBlock(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(o,{label:"创建时间"},{default:Vue.withCtx((()=>[Vue.createVNode(V,{modelValue:G.value,"onUpdate:modelValue":l[3]||(l[3]=e=>G.value=e),style:{width:"240px"},"value-format":"YYYY-MM-DD",type:"daterange","range-separator":"-","start-placeholder":"开始日期","end-placeholder":"结束日期"},null,8,["modelValue"])])),_:1}),Vue.createVNode(o,null,{default:Vue.withCtx((()=>[Vue.createVNode(d,{type:"primary",icon:"Search",onClick:de},{default:Vue.withCtx((()=>[f])),_:1}),Vue.createVNode(d,{icon:"Refresh",onClick:ie},{default:Vue.withCtx((()=>[h])),_:1})])),_:1})])),_:1},8,["model"]),[[Vue.vShow,Y.value]]),Vue.createVNode(z,{gutter:10,class:"mb8",style:{height:"35px"}},{default:Vue.withCtx((()=>[Vue.createVNode(c,{span:1.5},{default:Vue.withCtx((()=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(d,{type:"primary",plain:"",icon:"Plus",onClick:he},{default:Vue.withCtx((()=>[v])),_:1})),[[qe,["system/role/add"]]])])),_:1},8,["span"]),Vue.createVNode(c,{span:1.5},{default:Vue.withCtx((()=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(d,{type:"success",plain:"",icon:"Edit",disabled:j.value,onClick:ve},{default:Vue.withCtx((()=>[_])),_:1},8,["disabled"])),[[qe,["system/role/edit"]]])])),_:1},8,["span"]),Vue.createVNode(c,{span:1.5},{default:Vue.withCtx((()=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(d,{type:"danger",plain:"",icon:"Delete",disabled:H.value,onClick:ce},{default:Vue.withCtx((()=>[C])),_:1},8,["disabled"])),[[qe,["system/role/delete"]]])])),_:1},8,["span"]),Vue.createVNode(c,{span:1.5},{default:Vue.withCtx((()=>[Vue.withDirectives((Vue.openBlock(),Vue.createBlock(d,{type:"warning",plain:"",icon:"Download",onClick:se},{default:Vue.withCtx((()=>[w])),_:1})),[[qe,["system/role/export"]]])])),_:1},8,["span"]),Vue.createVNode(s,null,{default:Vue.withCtx((()=>[y])),_:1})])),_:1}),Vue.createCommentVNode(" 表格数据 "),Vue.withDirectives((Vue.openBlock(),Vue.createBlock(fe,{data:F.value,onSelectionChange:me},{default:Vue.withCtx((()=>[Vue.createVNode(M,{type:"selection",width:"55",align:"center"}),Vue.createVNode(M,{label:"角色编号",prop:"role_id",width:"120","show-overflow-tooltip":""}),Vue.createVNode(M,{label:"角色名称",prop:"role_name","show-overflow-tooltip":!0,width:"150"}),Vue.createVNode(M,{label:"权限字符",prop:"role_key","show-overflow-tooltip":!0,width:"150"}),Vue.createVNode(M,{label:"显示顺序",prop:"list_order",width:"100"}),Vue.createVNode(M,{label:"状态",align:"center",width:"100"},{default:Vue.withCtx((e=>[Vue.createVNode(ae,{modelValue:e.row.status,"onUpdate:modelValue":t=>e.row.status=t,"active-value":"1","inactive-value":"0",onChange:t=>function(e){let t="1"===e.status?"启用":"停用";$.$modal.confirm('确认要"'+t+'""'+e.role_name+'"角色吗?').then((function(){return a(e.role_id,e.status)})).then((()=>{$.$modal.msgSuccess(t+"成功")})).catch((function(){e.status="0"===e.status?"1":"0"}))}(e.row),disabled:!Vue.unref(m)(["system/role/change_status"])},null,8,["modelValue","onUpdate:modelValue","onChange","disabled"])])),_:1}),Vue.createVNode(M,{label:"创建时间",align:"center",prop:"created_at",width:"160"},{default:Vue.withCtx((t=>[Vue.createElementVNode("span",null,Vue.toDisplayString(e.parseTime(t.row.created_at)),1)])),_:1}),Vue.withDirectives((Vue.openBlock(),Vue.createBlock(M,{label:"操作",align:"center","class-name":"small-padding fixed-width"},{default:Vue.withCtx((e=>[Vue.createVNode(pe,{content:"修改",placement:"top"},{default:Vue.withCtx((()=>[1!==e.row.role_id?Vue.withDirectives((Vue.openBlock(),Vue.createBlock(d,{key:0,type:"text",icon:"Edit",onClick:t=>ve(e.row)},null,8,["onClick"])),[[qe,["system/role/edit"]]]):Vue.createCommentVNode("v-if",!0)])),_:2},1024),Vue.createVNode(pe,{content:"删除",placement:"top"},{default:Vue.withCtx((()=>[1!==e.row.role_id?Vue.withDirectives((Vue.openBlock(),Vue.createBlock(d,{key:0,type:"text",icon:"Delete",onClick:t=>ce(e.row)},null,8,["onClick"])),[[qe,["system/role/delete"]]]):Vue.createCommentVNode("v-if",!0)])),_:2},1024),Vue.createVNode(pe,{content:"数据权限",placement:"top"},{default:Vue.withCtx((()=>[Vue.withDirectives(Vue.createVNode(d,{type:"text",icon:"CircleCheck",onClick:t=>ge(e.row)},null,8,["onClick"]),[[qe,["system/role/set_data_scope"]]])])),_:2},1024),Vue.createVNode(pe,{content:"分配用户",placement:"top"},{default:Vue.withCtx((()=>[1!==e.row.role_id?Vue.withDirectives((Vue.openBlock(),Vue.createBlock(d,{key:0,type:"text",icon:"User",onClick:l=>{return u=e.row,void t.push("/system/role-auth/user/"+u.role_id);var u}},null,8,["onClick"])),[[qe,["system/role/add_auth_user","system/role/cancel_auth_user"]]]):Vue.createCommentVNode("v-if",!0)])),_:2},1024)])),_:1})),[[qe,["system/role/edit","system/role/delete","system/role/set_data_scope"]]])])),_:1},8,["data"])),[[Fe,L.value]]),Vue.withDirectives(Vue.createVNode(ye,{total:A.value,page:Vue.unref(oe).page_num,"onUpdate:page":l[4]||(l[4]=e=>Vue.unref(oe).page_num=e),limit:Vue.unref(oe).page_size,"onUpdate:limit":l[5]||(l[5]=e=>Vue.unref(oe).page_size=e),onPagination:Ve},null,8,["total","page","limit"]),[[Vue.vShow,A.value>0]]),Vue.createCommentVNode(" 添加或修改角色配置对话框 "),Vue.createVNode($e,{title:I.value,modelValue:P.value,"onUpdate:modelValue":l[17]||(l[17]=e=>P.value=e),width:"500px","append-to-body":""},{footer:Vue.withCtx((()=>[Vue.createElementVNode("div",b,[Vue.createVNode(d,{type:"primary",onClick:xe},{default:Vue.withCtx((()=>[B])),_:1}),Vue.createVNode(d,{onClick:ke},{default:Vue.withCtx((()=>[D])),_:1})])])),default:Vue.withCtx((()=>[Vue.createVNode(i,{ref:"roleRef",model:Vue.unref(re),rules:Vue.unref(ne),"label-width":"100px"},{default:Vue.withCtx((()=>[Vue.createVNode(o,{label:"角色名称",prop:"role_name"},{default:Vue.withCtx((()=>[Vue.createVNode(u,{modelValue:Vue.unref(re).role_name,"onUpdate:modelValue":l[6]||(l[6]=e=>Vue.unref(re).role_name=e),placeholder:"请输入角色名称"},null,8,["modelValue"])])),_:1}),Vue.createVNode(o,{prop:"role_key"},{label:Vue.withCtx((()=>[Vue.createElementVNode("span",null,[Vue.createVNode(pe,{content:"控制器中定义的权限字符，如：@PreAuthorize(`@ss.hasRole('admin')`)",placement:"top"},{default:Vue.withCtx((()=>[Vue.createVNode(Se,null,{default:Vue.withCtx((()=>[Vue.createVNode(De)])),_:1})])),_:1}),x])])),default:Vue.withCtx((()=>[Vue.createVNode(u,{modelValue:Vue.unref(re).role_key,"onUpdate:modelValue":l[7]||(l[7]=e=>Vue.unref(re).role_key=e),placeholder:"请输入权限字符"},null,8,["modelValue"])])),_:1}),Vue.createVNode(o,{label:"角色顺序",prop:"list_order"},{default:Vue.withCtx((()=>[Vue.createVNode(Ue,{modelValue:Vue.unref(re).list_order,"onUpdate:modelValue":l[8]||(l[8]=e=>Vue.unref(re).list_order=e),"controls-position":"right",min:0},null,8,["modelValue"])])),_:1}),Vue.createVNode(o,{label:"状态"},{default:Vue.withCtx((()=>[Vue.createVNode(Re,{modelValue:Vue.unref(re).status,"onUpdate:modelValue":l[9]||(l[9]=e=>Vue.unref(re).status=e)},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(q),(e=>(Vue.openBlock(),Vue.createBlock(Te,{key:e.value,label:e.value},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(e.label),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.createVNode(o,{label:"菜单权限"},{default:Vue.withCtx((()=>[Vue.createVNode(Ee,{modelValue:O.value,"onUpdate:modelValue":l[10]||(l[10]=e=>O.value=e),onChange:l[11]||(l[11]=e=>_e(e,"menu"))},{default:Vue.withCtx((()=>[k])),_:1},8,["modelValue"]),Vue.createVNode(Ee,{modelValue:Q.value,"onUpdate:modelValue":l[12]||(l[12]=e=>Q.value=e),onChange:l[13]||(l[13]=e=>Ce(e,"menu"))},{default:Vue.withCtx((()=>[N])),_:1},8,["modelValue"]),Vue.createVNode(Ee,{modelValue:Vue.unref(re).menuCheckStrictly,"onUpdate:modelValue":l[14]||(l[14]=e=>Vue.unref(re).menuCheckStrictly=e),onChange:l[15]||(l[15]=e=>we(e,"menu"))},{default:Vue.withCtx((()=>[g])),_:1},8,["modelValue"]),Vue.createVNode(Ke,{class:"tree-border",data:J.value,"show-checkbox":"",ref_key:"menuRef",ref:te,"node-key":"id","check-strictly":!Vue.unref(re).menuCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"menu_name",children:"children"}},null,8,["data","check-strictly"])])),_:1}),Vue.createVNode(o,{label:"备注"},{default:Vue.withCtx((()=>[Vue.createVNode(u,{modelValue:Vue.unref(re).remark,"onUpdate:modelValue":l[16]||(l[16]=e=>Vue.unref(re).remark=e),type:"textarea",placeholder:"请输入内容"},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"]),Vue.createCommentVNode(" 分配角色数据权限对话框 "),Vue.createVNode($e,{title:I.value,modelValue:ee.value,"onUpdate:modelValue":l[27]||(l[27]=e=>ee.value=e),width:"500px","append-to-body":""},{footer:Vue.withCtx((()=>[Vue.createElementVNode("div",R,[Vue.createVNode(d,{type:"primary",onClick:be},{default:Vue.withCtx((()=>[E])),_:1}),Vue.createVNode(d,{onClick:Be},{default:Vue.withCtx((()=>[K])),_:1})])])),default:Vue.withCtx((()=>[Vue.createVNode(i,{model:Vue.unref(re),"label-width":"80px"},{default:Vue.withCtx((()=>[Vue.createVNode(o,{label:"角色名称"},{default:Vue.withCtx((()=>[Vue.createVNode(u,{modelValue:Vue.unref(re).role_name,"onUpdate:modelValue":l[18]||(l[18]=e=>Vue.unref(re).role_name=e),disabled:!0},null,8,["modelValue"])])),_:1}),Vue.createVNode(o,{label:"权限字符"},{default:Vue.withCtx((()=>[Vue.createVNode(u,{modelValue:Vue.unref(re).role_key,"onUpdate:modelValue":l[19]||(l[19]=e=>Vue.unref(re).role_key=e),disabled:!0},null,8,["modelValue"])])),_:1}),Vue.createVNode(o,{label:"权限范围"},{default:Vue.withCtx((()=>[Vue.createVNode(n,{modelValue:Vue.unref(re).data_scope,"onUpdate:modelValue":l[20]||(l[20]=e=>Vue.unref(re).data_scope=e),onChange:Ne},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(ue.value,(e=>(Vue.openBlock(),Vue.createBlock(r,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),Vue.withDirectives(Vue.createVNode(o,{label:"数据权限"},{default:Vue.withCtx((()=>[Vue.createVNode(Ee,{modelValue:W.value,"onUpdate:modelValue":l[21]||(l[21]=e=>W.value=e),onChange:l[22]||(l[22]=e=>_e(e,"dept"))},{default:Vue.withCtx((()=>[S])),_:1},8,["modelValue"]),Vue.createVNode(Ee,{modelValue:X.value,"onUpdate:modelValue":l[23]||(l[23]=e=>X.value=e),onChange:l[24]||(l[24]=e=>Ce(e,"dept"))},{default:Vue.withCtx((()=>[U])),_:1},8,["modelValue"]),Vue.createVNode(Ee,{modelValue:Vue.unref(re).deptCheckStrictly,"onUpdate:modelValue":l[25]||(l[25]=e=>Vue.unref(re).deptCheckStrictly=e),disabled:"",onChange:l[26]||(l[26]=e=>we(e,"dept"))},{default:Vue.withCtx((()=>[T])),_:1},8,["modelValue"]),Vue.createVNode(Ke,{class:"tree-border",data:Z.value,"show-checkbox":"","default-expand-all":"",ref_key:"deptRef",ref:le,"node-key":"dept_id","check-strictly":!Vue.unref(re).deptCheckStrictly,"empty-text":"加载中，请稍候",props:{label:"dept_name",children:"children"}},null,8,["data","check-strictly"])])),_:1},512),[[Vue.vShow,2==Vue.unref(re).data_scope]])])),_:1},8,["model"])])),_:1},8,["title","modelValue"])])}}}),[["__file","E:/LingDu/rust/poem/RuoYi-Vue3/src/views/system/role/index.vue"]]);export{q as default};
