import{m as e,q as l,E as u,k as t,A as a}from"./index.js";import{u as o}from"./useFormUtil-98c17c20.js";const V={class:"dialog-footer"},n=Vue.defineComponent({__name:"role-manage-data-scope-dialog",props:{roleData:{type:Object,required:!0},openDataScope:{type:Boolean,default:!1},title:{type:String,default:""}},emits:["closeDialog"],setup(n,{emit:r}){const d=n,c=Vue.ref({...d.roleData}),s=Vue.ref(),m=Vue.ref(),{formValidate:f}=o(),{t:p}=VueI18n.useI18n({useScope:"global"}),i=Vue.ref([]),E=Vue.ref(!0),_=Vue.ref(!1),x=Vue.ref({label:"dept_name",children:"children"}),h=Vue.ref([{value:"1",label:"全部数据权限"},{value:"2",label:"自定数据权限"},{value:"3",label:"本部门数据权限"},{value:"4",label:"本部门及以下数据权限"},{value:"5",label:"仅本人数据权限"}]),v=e=>{const l=i.value;for(let u=0;u<l.length;u++)m.value.store.nodesMap[l[u].dept_id].expanded=e},C=async e=>{let u=[];if("2"===e){const{data:e,execute:a}=t(l.getRoleDepts,{role_id:d.roleData.role_id});await a(),u=e.value}Vue.nextTick((()=>{var e;null==(e=m.value)||e.setCheckedKeys(u)}))},w=()=>{r("closeDialog")};return(async()=>{await(async()=>{const{data:e,execute:l}=t(a.getDeptTree);await l(),i.value=e.value})(),"2"===d.roleData.data_scope&&C("2")})(),(t,a)=>{const o=Vue.resolveComponent("el-checkbox"),r=Vue.resolveComponent("el-scrollbar");return Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElDialog),{modelValue:n.openDataScope,"onUpdate:modelValue":a[6]||(a[6]=e=>Vue.isRef(openDataScope)?openDataScope.value=e:null),"before-close":w,title:n.title,"append-to-body":"",width:"450px"},{footer:Vue.withCtx((()=>[Vue.createElementVNode("div",V,[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{type:"primary",onClick:a[5]||(a[5]=t=>(async t=>{var a;if(!(await f(t)))return;const o=null==(a=m.value)?void 0:a.getCheckedKeys(!1);let V={...c.value};V.dept_ids="2"===V.data_scope?o:[];const{data:n,execute:r}=e(l.setDataScope,V);await r(),n.value!==u&&(ElementPlus.ElMessage.success(`更新 ${c.value.role_name} 数据权限成功`),w())})(s.value))},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(p)("common.submit")),1)])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElButton),{onClick:w},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(p)("common.cancel")),1)])),_:1})])])),default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElForm),{ref_key:"dataScopeFormRef",ref:s,model:c.value,class:"base-form","label-width":"100px"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElRow),null,{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:24},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"角色名称",prop:"role_name"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:c.value.role_name,"onUpdate:modelValue":a[0]||(a[0]=e=>c.value.role_name=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:24},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"角色标志",prop:"role_key"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:c.value.role_key,"onUpdate:modelValue":a[1]||(a[1]=e=>c.value.role_key=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:24},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"权限范围"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElSelect),{modelValue:c.value.data_scope,"onUpdate:modelValue":a[2]||(a[2]=e=>c.value.data_scope=e),onChange:C},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(h.value,(e=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElOption),{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1})])),_:1}),"2"===c.value.data_scope?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElRow),{key:0},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:24},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"数据权限"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:24},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElRow),null,{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:8},{default:Vue.withCtx((()=>[Vue.createVNode(o,{modelValue:E.value,"onUpdate:modelValue":a[3]||(a[3]=e=>E.value=e),onChange:v},{default:Vue.withCtx((()=>[Vue.createTextVNode(" 展开/折叠 ")])),_:1},8,["modelValue"])])),_:1})])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElRow),null,{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:24},{default:Vue.withCtx((()=>[Vue.createVNode(r,{"max-height":"200px"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElTree),{ref_key:"deptTreeRef",ref:m,data:i.value,"show-checkbox":"","node-key":"dept_id","check-strictly":!_.value,"default-expand-all":E.value,"empty-text":"加载中，请稍候",props:x.value},null,8,["data","check-strictly","default-expand-all","props"])])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})):Vue.createCommentVNode("",!0),Vue.createVNode(Vue.unref(ElementPlus.ElRow),null,{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:24},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:"备注",prop:"remark"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:c.value.remark,"onUpdate:modelValue":a[4]||(a[4]=e=>c.value.remark=e),maxlength:"50",placeholder:"请输入邮箱",type:"textarea"},null,8,["modelValue"])])),_:1})])),_:1})])),_:1})])),_:1},8,["model"])])),_:1},8,["modelValue","title"])}}});export{n as _};
