import{u as e,s as r,m as l,j as o,E as u,x as s,y as a}from"./index.js";import{E as t}from"./useTabBar-7d8415a5.js";import{u as d}from"./useFormUtil-98c17c20.js";const n=Vue.defineComponent({name:"reset-password"}),V=Vue.defineComponent({...n,setup(n){const{formValidate:V}=d(),m=e(),{t:w}=VueI18n.useI18n({useScope:"global"}),i=Vue.reactive({oldPassword:void 0,newPassword:void 0,confirmPassword:void 0}),p=Vue.ref(),f=Vue.ref({oldPassword:[{required:!0,message:"旧密码不能为空",trigger:"blur"}],newPassword:[{required:!0,message:"新密码不能为空",trigger:"blur"},{min:6,max:20,message:"长度在 6 到 20 个字符",trigger:"blur"}],confirmPassword:[{required:!0,message:"确认密码不能为空",trigger:"blur"},{required:!0,validator:(e,r,l)=>{i.newPassword!==r?l(new Error("两次输入的密码不一致")):l()},trigger:"blur"}]}),c=async()=>{if(!(await V(p.value)))return;const e={old_passwd:r(i.oldPassword),new_passwd:r(i.newPassword)},{execute:a,data:t}=l(o.updatePwd,e);await a(),t.value!==u&&(ElementPlus.ElMessage.success("修改成功,请重新登录,秒钟后将自动退出并转入登录界面"),await m.logOut(),setTimeout((()=>s.push(`/login?redirect=${s.currentRoute.value.fullPath}`)),1e3))},P=()=>{s.back(),a(t.current)};return(e,r)=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElForm),{ref_key:"pwdRef",ref:p,model:i,rules:f.value,"label-width":"120px"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:Vue.unref(w)("profile.oldPassword"),prop:"oldPassword"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:i.oldPassword,"onUpdate:modelValue":r[0]||(r[0]=e=>i.oldPassword=e),placeholder:Vue.unref(w)("profile.oldPassword"),type:"password","show-password":""},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:Vue.unref(w)("profile.newPassword"),prop:"newPassword"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:i.newPassword,"onUpdate:modelValue":r[1]||(r[1]=e=>i.newPassword=e),placeholder:Vue.unref(w)("profile.newPassword"),type:"password","show-password":""},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:Vue.unref(w)("profile.confirmPassword"),prop:"confirmPassword"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:i.confirmPassword,"onUpdate:modelValue":r[2]||(r[2]=e=>i.confirmPassword=e),placeholder:Vue.unref(w)("profile.confirmPassword"),type:"password","show-password":""},null,8,["modelValue","placeholder"])])),_:1},8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),null,{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{type:"primary",onClick:c},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(w)("common.save")),1)])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElButton),{type:"danger",onClick:P},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(w)("common.close")),1)])),_:1})])),_:1})])),_:1},8,["model","rules"]))}});export{V as _};
