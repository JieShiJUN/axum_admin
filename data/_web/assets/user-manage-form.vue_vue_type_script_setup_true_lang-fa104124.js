import{s as e,r as u,p as l,e as t,d as n,k as a}from"./index-174ad176.js";import{i as o,j as r,p as V,m as s,E as i,s as c}from"./index.js";import{u as m,P as d,a as p}from"./pagination-87b07e34.js";import{R as f}from"./right-tool-bar-f10e816b.js";import{h as E}from"./usePermission-16d8d5ac.js";import{u as h}from"./useTableUtil-0e4d2f9a.js";import{d as _}from"./dict-2940434e.js";import{_ as w}from"./user-manage-dialog.vue_vue_type_script_setup_true_lang-acbceb98.js";const g=Vue.defineComponent({__name:"user-manage-form",props:{dept_id:{type:String}},setup(g){const C=g,{t:v}=VueI18n.useI18n({useScope:"global"}),b=Vue.ref(!1),k=Vue.ref(""),P=Vue.ref(""),N=o(_.sysNormalDisable,_.sysUserSex,_.isAdmin),y=Vue.ref(!0),x=Vue.ref([]),{useTableSelectChange:B}=h(),{handleSelectionChangeFn:T,ids:S,values:D,single:I,selected:U}=B(),j=e=>T(e,"id","user_name"),F=Vue.ref({page_num:1,page_size:10}),{list:M,getListFn:$,total:K}=m(r.getList,F,x),Y=()=>{F.value.dept_id=void 0,x.value=[],$()},z=()=>{P.value="",k.value="新增用户",b.value=!0},L=async e=>{P.value=(null==e?void 0:e.id)||S.value[0],k.value="修改用户",b.value=!0},R=async e=>{await p(r.delete,"id",S,"user_name",D,"user_ids",e)&&$()},Q=()=>{b.value=!1,$()};return Vue.watch((()=>C.dept_id),(e=>{F.value.dept_id=e,$()})),(o,m)=>(Vue.openBlock(),Vue.createElementBlock("div",null,[Vue.withDirectives(Vue.createVNode(Vue.unref(ElementPlus.ElForm),{ref:"queryRef",inline:!0,model:F.value,class:"base-form","label-width":"68px"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:Vue.unref(v)("user.name"),prop:"user_name"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:F.value.user_name,"onUpdate:modelValue":m[0]||(m[0]=e=>F.value.user_name=e),clearable:"",placeholder:Vue.unref(v)("user.nameTip"),onKeyup:Vue.withKeys(Vue.unref($),["enter"])},null,8,["modelValue","placeholder","onKeyup"])])),_:1},8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:Vue.unref(v)("common.phoneNum"),prop:"phone_num"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElInput),{modelValue:F.value.phone_num,"onUpdate:modelValue":m[1]||(m[1]=e=>F.value.phone_num=e),clearable:"",placeholder:Vue.unref(v)("common.phoneNum"),onKeyup:Vue.withKeys(Vue.unref($),["enter"])},null,8,["modelValue","placeholder","onKeyup"])])),_:1},8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:Vue.unref(v)("common.status"),prop:"user_status"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElSelect),{modelValue:F.value.user_status,"onUpdate:modelValue":m[2]||(m[2]=e=>F.value.user_status=e),clearable:"",placeholder:Vue.unref(v)("common.status")},{default:Vue.withCtx((()=>[(Vue.openBlock(!0),Vue.createElementBlock(Vue.Fragment,null,Vue.renderList(Vue.unref(N)[Vue.unref(_).sysNormalDisable],(e=>(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElOption),{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue","placeholder"])])),_:1},8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),{label:Vue.unref(v)("common.createTime2")},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElDatePicker),{modelValue:x.value,"onUpdate:modelValue":m[3]||(m[3]=e=>x.value=e),"start-placeholder":Vue.unref(v)("common.beginTime"),"end-placeholder":Vue.unref(v)("common.endTime"),"range-separator":"-",type:"daterange","value-format":"YYYY-MM-DD"},null,8,["modelValue","start-placeholder","end-placeholder"])])),_:1},8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElFormItem),null,{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{icon:Vue.unref(e),type:"primary",onClick:Vue.unref($)},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(v)("common.search")),1)])),_:1},8,["icon","onClick"]),Vue.createVNode(Vue.unref(ElementPlus.ElButton),{icon:Vue.unref(u),onClick:Y},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(v)("common.reset")),1)])),_:1},8,["icon"])])),_:1})])),_:1},8,["model"]),[[Vue.vShow,y.value]]),Vue.createVNode(Vue.unref(ElementPlus.ElRow),{gutter:10,class:"m-b-8px",style:{height:"35px"}},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:1.5},{default:Vue.withCtx((()=>[Vue.unref(E)(Vue.unref(r).add)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElButton),{key:0,icon:Vue.unref(l),plain:"",type:"primary",onClick:z},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(v)("common.add")),1)])),_:1},8,["icon"])):Vue.createCommentVNode("",!0)])),_:1},8,["span"]),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:1.5},{default:Vue.withCtx((()=>[Vue.unref(E)(Vue.unref(r).edit)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElButton),{key:0,disabled:!Vue.unref(I),icon:Vue.unref(t),plain:"",type:"success",onClick:m[4]||(m[4]=e=>L())},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(v)("common.edit")),1)])),_:1},8,["disabled","icon"])):Vue.createCommentVNode("",!0)])),_:1},8,["span"]),Vue.createVNode(Vue.unref(ElementPlus.ElCol),{span:1.5},{default:Vue.withCtx((()=>[Vue.unref(E)(Vue.unref(r).delete)?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElButton),{key:0,disabled:!Vue.unref(U),icon:Vue.unref(n),plain:"",type:"danger",onClick:m[5]||(m[5]=e=>R())},{default:Vue.withCtx((()=>[Vue.createTextVNode(Vue.toDisplayString(Vue.unref(v)("common.delete")),1)])),_:1},8,["disabled","icon"])):Vue.createCommentVNode("",!0)])),_:1},8,["span"]),Vue.createVNode(f,{showSearch:y.value,"onUpdate:showSearch":m[6]||(m[6]=e=>y.value=e),onQueryTable:Vue.unref($)},null,8,["showSearch","onQueryTable"])])),_:1}),Vue.createVNode(Vue.unref(ElementPlus.ElTable),{data:Vue.unref(M),"tooltip-effect":"light",onSelectionChange:j},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{align:"center",type:"selection",width:"50"}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{key:"id",align:"center",label:"ID",prop:"id","show-overflow-tooltip":"",width:"100"}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{key:"user_name","show-overflow-tooltip":!0,align:"center",label:Vue.unref(v)("profile.name"),prop:"user_name"},null,8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{key:"user_nickname","show-overflow-tooltip":!0,align:"center",label:Vue.unref(v)("profile.nickName"),prop:"user_nickname"},null,8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{key:"dept_id","show-overflow-tooltip":!0,align:"center",label:Vue.unref(v)("user.dept"),prop:"dept.dept_name"},null,8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{key:"phone_num",align:"center",label:"手机号码",prop:"phone_num",width:"120"}),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{key:"user_status",align:"center",label:Vue.unref(v)("common.status")},{default:Vue.withCtx((e=>[Vue.createVNode(Vue.unref(ElementPlus.ElSwitch),{modelValue:e.row.user_status,"onUpdate:modelValue":u=>e.row.user_status=u,"active-value":"1","inactive-value":"0",onChange:u=>(async e=>{const u="1"===e.user_status?"启用":"停用";await ElementPlus.ElMessageBox.confirm(`确定要  ${u}  ${e.user_name}  吗?`,"切换用户状态",{type:"warning"}).then((async()=>{const{data:l,execute:t}=s(r.changeStatus,{user_id:e.id,status:e.user_status});await t(),l.value!==i&&(ElementPlus.ElMessage.success(`你成功 ${u} 用户 ${e.user_name}`),$())})).catch((()=>{ElementPlus.ElMessage.info("你取消了操作"),e.user_status="0"===e.user_status?"1":"0"}))})(e.row)},null,8,["modelValue","onUpdate:modelValue","onChange"])])),_:1},8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{align:"center",label:Vue.unref(v)("common.createTime"),prop:"created_at",width:"170"},{default:Vue.withCtx((e=>[Vue.createElementVNode("span",null,Vue.toDisplayString(Vue.unref(V)(e.row.created_at)),1)])),_:1},8,["label"]),Vue.createVNode(Vue.unref(ElementPlus.ElTableColumn),{align:"center",label:Vue.unref(v)("common.operation"),width:"150"},{default:Vue.withCtx((e=>[1!==e.row.userId?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElTooltip),{key:0,content:Vue.unref(v)("common.edit"),effect:"light",placement:"top"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{icon:Vue.unref(t),link:"",onClick:u=>L(e.row)},null,8,["icon","onClick"])])),_:2},1032,["content"])):Vue.createCommentVNode("",!0),1!==e.row.userId?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElTooltip),{key:1,content:Vue.unref(v)("common.delete"),effect:"light",placement:"top"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{icon:Vue.unref(n),link:"",onClick:u=>R(e.row)},null,8,["icon","onClick"])])),_:2},1032,["content"])):Vue.createCommentVNode("",!0),1!==e.row.userId?(Vue.openBlock(),Vue.createBlock(Vue.unref(ElementPlus.ElTooltip),{key:2,content:Vue.unref(v)("user.restPwd"),effect:"light",placement:"top"},{default:Vue.withCtx((()=>[Vue.createVNode(Vue.unref(ElementPlus.ElButton),{icon:Vue.unref(a),link:"",onClick:u=>{return l=e.row,void ElementPlus.ElMessageBox.prompt(`请输入 ${l.user_name} 的新密码`,"重置密码",{confirmButtonText:"确认",cancelButtonText:"取消",inputPattern:/^.{5,32}$/,inputErrorMessage:"用户密码长度必须介于 5 和 32 之间"}).then((async({value:e})=>{const u={user_id:l.id,new_passwd:c(e)},{data:t,execute:n}=s(r.resetPwd,u);await n(),t.value!==i&&ElementPlus.ElMessage.success(`用户 ${l.user_name} 的密码成功重置为 ${e}`)})).catch((()=>{ElementPlus.ElMessage.info("你取消了操作")}));var l}},null,8,["icon","onClick"])])),_:2},1032,["content"])):Vue.createCommentVNode("",!0)])),_:1},8,["label"])])),_:1},8,["data"]),Vue.withDirectives(Vue.createVNode(d,{limit:F.value.page_size,"onUpdate:limit":m[7]||(m[7]=e=>F.value.page_size=e),page:F.value.page_num,"onUpdate:page":m[8]||(m[8]=e=>F.value.page_num=e),total:Vue.unref(K),onPagination:Vue.unref($)},null,8,["limit","page","total","onPagination"]),[[Vue.vShow,Vue.unref(K)>0]]),b.value?(Vue.openBlock(),Vue.createBlock(w,{key:0,open:b.value,title:k.value,"user-id":P.value,onCloseDialog:Q},null,8,["open","title","user-id"])):Vue.createCommentVNode("",!0)]))}});export{g as _};
